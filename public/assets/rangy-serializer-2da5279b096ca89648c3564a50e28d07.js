rangy.createModule("Serializer",function(e,n){function o(e,n){n=n||[];var t=e.nodeType,r=e.childNodes,i=r.length,a=[t,e.nodeName,i].join(":"),c="",d="";switch(t){case 3:c=e.nodeValue.replace(/</g,"&lt;").replace(/>/g,"&gt;");break;case 8:c="<!--"+e.nodeValue.replace(/</g,"&lt;").replace(/>/g,"&gt;")+"-->";break;default:c="<"+a+">",d="</>"}for(c&&n.push(c),t=0;i>t;++t)o(r[t],n);return d&&n.push(d),n}function t(e){return e=o(e).join(""),u(e).toString(16)}function r(e,n,o){var t=[],r=e;for(o=o||m.getDocument(e).documentElement;r&&r!=o;)t.push(m.getNodeIndex(r,!0)),r=r.parentNode;return t.join("/")+":"+n}function i(e,o,t){o?t||m.getDocument(o):(t=t||document,o=t.documentElement),e=e.split(":"),o=o,t=e[0]?e[0].split("/"):[];for(var r,i=t.length;i--;){if(r=parseInt(t[i],10),!(r<o.childNodes.length))throw n.createError("deserializePosition failed: node "+m.inspectNode(o)+" has no child with index "+r+", "+i);o=o.childNodes[parseInt(t[i],10)]}return new m.DomPosition(o,parseInt(e[1],10))}function a(n,o,i){if(i=i||e.DomRange.getRangeDocument(n).documentElement,!m.isAncestorOf(i,n.commonAncestorContainer,!0))throw Error("serializeRange: range is not wholly contained within specified root node");return n=r(n.startContainer,n.startOffset,i)+","+r(n.endContainer,n.endOffset,i),o||(n+="{"+t(i)+"}"),n}function c(n,o,r){o?r=r||m.getDocument(o):(r=r||document,o=r.documentElement),n=/^([^,]+),([^,\{]+)({([^}]+)})?$/.exec(n);var a=n[4],c=t(o);if(a&&a!==t(o))throw Error("deserializeRange: checksums of serialized range root node ("+a+") and target root node ("+c+") do not match");return a=i(n[1],o,r),o=i(n[2],o,r),r=e.createRange(r),r.setStart(a.node,a.offset),r.setEnd(o.node,o.offset),r}function d(e,n,o){return n?o||m.getDocument(n):(o=o||document,n=o.documentElement),e=/^([^,]+),([^,]+)({([^}]+)})?$/.exec(e)[3],!e||e===t(n)}function l(n,o,t){n=n||e.getSelection(),n=n.getAllRanges();for(var r=[],i=0,c=n.length;c>i;++i)r[i]=a(n[i],o,t);return r.join("|")}function s(n,o,t){o?t=t||m.getWindow(o):(t=t||window,o=t.document.documentElement),n=n.split("|");for(var r=e.getSelection(t),i=[],a=0,d=n.length;d>a;++a)i[a]=c(n[a],o,t.document);return r.setRanges(i),r}e.requireModules(["WrappedSelection","WrappedRange"]),("undefined"==typeof encodeURIComponent||"undefined"==typeof decodeURIComponent)&&n.fail("Global object is missing encodeURIComponent and/or decodeURIComponent method");var u=function(){var e=null;return function(n){for(var o,t=[],r=0,i=n.length;i>r;++r)o=n.charCodeAt(r),128>o?t.push(o):2048>o?t.push(o>>6|192,63&o|128):t.push(o>>12|224,o>>6&63|128,63&o|128);if(n=-1,!e){r=[],i=0;for(var a;256>i;++i){for(a=i,o=8;o--;)1==(1&a)?a=a>>>1^3988292384:a>>>=1;r[i]=a>>>0}e=r}for(r=e,i=0,o=t.length;o>i;++i)a=255&(n^t[i]),n=n>>>8^r[a];return(-1^n)>>>0}}(),m=e.dom;e.serializePosition=r,e.deserializePosition=i,e.serializeRange=a,e.deserializeRange=c,e.canDeserializeRange=d,e.serializeSelection=l,e.deserializeSelection=s,e.canDeserializeSelection=function(e,n,o){var t;n?t=o?o.document:m.getDocument(n):(o=o||window,n=o.document.documentElement),e=e.split("|"),o=0;for(var r=e.length;r>o;++o)if(!d(e[o],n,t))return!1;return!0},e.restoreSelectionFromCookie=function(e){e=e||window;var n;e:{n=e.document.cookie.split(/[;,]/);for(var o,t=0,r=n.length;r>t;++t)if(o=n[t].split("="),"rangySerializedSelection"==o[0].replace(/^\s+/,"")&&(o=o[1])){n=decodeURIComponent(o.replace(/\s+$/,""));break e}n=null}n&&s(n,e.doc)},e.saveSelectionCookie=function(n,o){n=n||window,o="object"==typeof o?o:{};var t=o.expires?";expires="+o.expires.toUTCString():"",r=o.path?";path="+o.path:"",i=o.domain?";domain="+o.domain:"",a=o.secure?";secure":"",c=l(e.getSelection(n));n.document.cookie=encodeURIComponent("rangySerializedSelection")+"="+encodeURIComponent(c)+t+r+i+a},e.getElementChecksum=t});