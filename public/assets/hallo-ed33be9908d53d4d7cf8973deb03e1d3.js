(function(){$.widget("ncri.hallohtml",{options:{editable:null,toolbar:null,uuid:"",lang:"en",dialogOpts:{autoOpen:!1,width:600,height:"auto",modal:!1,resizable:!0,draggable:!0,dialogClass:"htmledit-dialog"},dialog:null,buttonCssClass:null},translations:{en:{title:"Edit HTML",update:"Update"},de:{title:"HTML bearbeiten",update:"Aktualisieren"}},texts:null,populateToolbar:function(t){var e,i,o,n;return n=this,this.texts=this.translations[this.options.lang],this.options.toolbar=t,this.options.dialog=$("<div>").attr("id",""+this.options.uuid+"-htmledit-dialog"),i=$("<span>").addClass(n.widgetName),o=""+this.options.uuid+"-htmledit",e=$("<span>"),e.hallobutton({label:this.texts.title,icon:"icon-list-alt",editable:this.options.editable,command:null,queryState:!1,uuid:this.options.uuid,cssClass:this.options.buttonCssClass}),i.append(e),this.button=e,this.button.click(function(){return n.options.dialog.dialog("isOpen")?n._closeDialog():n._openDialog(),!1}),this.options.editable.element.on("hallodeactivated",function(){return n._closeDialog()}),t.append(i),this.options.dialog.dialog(this.options.dialogOpts),this.options.dialog.dialog("option","title",this.texts.title)},_openDialog:function(){var t,e,i,o,n,s=this;return i=this,t=$(this.options.editable.element),o=t.offset().left+t.outerWidth()+10,n=this.options.toolbar.offset().top-$(document).scrollTop(),this.options.dialog.dialog("option","position",[o,n]),this.options.editable.keepActivated(!0),this.options.dialog.dialog("open"),this.options.dialog.on("dialogclose",function(){return $("label",s.button).removeClass("ui-state-active"),s.options.editable.element.focus(),s.options.editable.keepActivated(!1)}),this.options.dialog.html($("<textarea>").addClass("html_source")),e=this.options.editable.element.html(),this.options.dialog.children(".html_source").val(e),this.options.dialog.prepend($("<button>"+this.texts.update+"</button>")),this.options.dialog.on("click","button",function(){return e=i.options.dialog.children(".html_source").val(),i.options.editable.element.html(e),i.options.editable.element.trigger("change"),!1})},_closeDialog:function(){return this.options.dialog.dialog("close")}}),function(t){return t.widget("IKS.hallolists",{options:{editable:null,toolbar:null,uuid:"",lists:{ordered:!0,unordered:!0},buttonCssClass:null},populateToolbar:function(e){var i,o,n=this;return o=t('<span class="'+this.widgetName+'"></span>'),i=function(e,i){var s;return s=t("<span></span>"),s.hallobutton({uuid:n.options.uuid,editable:n.options.editable,label:i,command:"insert"+e+"List",icon:"icon-list-"+i.toLowerCase(),cssClass:n.options.buttonCssClass}),o.append(s)},this.options.lists.ordered&&i("Ordered","OL"),this.options.lists.unordered&&i("Unordered","UL"),o.hallobuttonset(),e.append(o)}})}(jQuery),function(t){return t.widget("IKS.halloformat",{options:{editable:null,uuid:"",formattings:{bold:!0,italic:!0,strikeThrough:!1,underline:!1},buttonCssClass:null},populateToolbar:function(e){var i,o,n,s,a,l,r=this;a=this,o=t('<span class="'+a.widgetName+'"></span>'),i=function(e){var i;return i=t("<span></span>"),i.hallobutton({label:e,editable:r.options.editable,command:e,uuid:r.options.uuid,cssClass:r.options.buttonCssClass}),o.append(i)},l=this.options.formattings;for(s in l)n=l[s],n&&i(s);return o.hallobuttonset(),e.append(o)}})}(jQuery),function(t){return t.widget("IKS.hallolink",{options:{editable:null,uuid:"",link:!0,image:!0,defaultUrl:"http://",dialogOpts:{autoOpen:!1,width:540,height:95,title:"Enter Link",buttonTitle:"Insert",buttonUpdateTitle:"Update",modal:!0,resizable:!1,draggable:!1,dialogClass:"hallolink-dialog"},buttonCssClass:null},populateToolbar:function(e){var i,o,n,s,a,l,r,u,h,d,c=this;return d=this,l=""+this.options.uuid+"-dialog",i=this.options.dialogOpts.buttonTitle,o=this.options.dialogOpts.buttonUpdateTitle,a=t('<div id="'+l+'">        <form action="#" method="post" class="linkForm">          <input class="url" type="text" name="url"            value="'+this.options.defaultUrl+'" />          <input type="submit" id="addlinkButton" value="'+i+'"/>        </form></div>'),h=t("input[name=url]",a).focus(function(){return this.select()}),u=function(t){return new RegExp(/^\s*$/).test(t)?!0:t===d.options.defaultUrl?!0:!1},r=function(t){var e,i;return t.preventDefault(),e=h.val(),d.options.editable.restoreSelection(d.lastSelection),u(e)?(i=d.lastSelection.startContainer,d.lastSelection.collapsed&&(d.lastSelection.setStartBefore(i),d.lastSelection.setEndAfter(i),window.getSelection().addRange(d.lastSelection)),document.execCommand("unlink",null,"")):(/:\/\//.test(e)||/^mailto:/.test(e)||(e="http://"+e),void 0===d.lastSelection.startContainer.parentNode.href?document.execCommand("createLink",null,e):d.lastSelection.startContainer.parentNode.href=e),d.options.editable.element.trigger("change"),d.options.editable.removeAllSelections(),a.dialog("close"),!1},a.find("input[type=submit]").click(r),s=t('<span class="'+d.widgetName+'"></span>'),n=function(e){var n,l,r;return r=""+c.options.uuid+"-"+e,l=t("<span></span>"),l.hallobutton({label:"Link",icon:"icon-link",editable:c.options.editable,command:null,queryState:!1,uuid:c.options.uuid,cssClass:c.options.buttonCssClass}),s.append(l),n=l,n.on("click",function(){var e,n;return d.lastSelection=d.options.editable.getSelection(),h=t("input[name=url]",a),n=d.lastSelection.startContainer.parentNode,n.href?(h.val(t(n).attr("href")),e="input[type=submit]",t(h[0].form).find(e).val(o)):(h.val(d.options.defaultUrl),t(h[0].form).find("input[type=submit]").val(i)),d.options.editable.keepActivated(!0),a.dialog("open"),a.on("dialogclose",function(){return t("label",l).removeClass("ui-state-active"),d.options.editable.element.focus(),d.options.editable.keepActivated(!1)}),!1}),c.element.on("keyup paste change mouseup",function(){var e,i;return i=t(d.options.editable.getSelection().startContainer),e=i.prop("nodeName")?i.prop("nodeName"):i.parent().prop("nodeName"),e&&"A"===e.toUpperCase()?void t("label",n).addClass("ui-state-active"):t("label",n).removeClass("ui-state-active")})},this.options.link&&n("A"),this.options.link?(e.append(s),s.hallobuttonset(),a.dialog(this.options.dialogOpts)):void 0}})}(jQuery),$.widget("ncri.hallo-image-insert-edit",{options:{editable:null,toolbar:null,uuid:"",insert_file_dialog_ui_url:null,lang:"en",dialogOpts:{autoOpen:!1,width:560,height:"auto",modal:!1,resizable:!0,draggable:!0,dialogClass:"insert-image-dialog"},dialog:null,buttonCssClass:null},translations:{en:{title_insert:"Insert Image",title_properties:"Image Properties",insert:"Insert",chage_image:"Change Image:",source:"URL",width:"Width",height:"Height",alt:"Alt Text",padding:"Padding","float":"Float",float_left:"left",float_right:"right",float_none:"No"},de:{title_insert:"Bild einf\xfcgen",title_properties:"Bildeigenschaften",insert:"Einf\xfcgen",chage_image:"Bild \xe4ndern:",source:"URL",width:"Breite",height:"H\xf6he",alt:"Alt Text",padding:"Padding","float":"Float",float_left:"Links",float_right:"Rechts",float_none:"Nein"}},texts:null,dialog_image_selection_ui_loaded:!1,$image:null,populateToolbar:function(t){var e,i,o,n;return n=this,this.texts=this.translations[this.options.lang],this.options.toolbar=t,o="<div id='hallo_img_properties'></div>",this.options.insert_file_dialog_ui_url&&(o+="<div id='hallo_img_file_select_ui'></div>"),this.options.dialog=$("<div>").attr("id",""+this.options.uuid+"-insert-image-dialog").html(o),i=$("<span>").addClass(this.widgetName),e=$("<span>"),e.hallobutton({label:this.texts.title_insert,icon:"icon-picture",editable:this.options.editable,command:null,queryState:!1,uuid:this.options.uuid,cssClass:this.options.buttonCssClass}),i.append(e),this.button=e,this.button.click(function(){return n.options.dialog.dialog("isOpen")?n._closeDialog():(n.lastSelection=n.options.editable.getSelection(),n._openDialog()),!1}),this.options.editable.element.on("halloselected, hallounselected",function(){return n.options.dialog.dialog("isOpen")?n.lastSelection=n.options.editable.getSelection():void 0}),this.options.editable.element.on("hallodeactivated",function(){return n._closeDialog()}),$(this.options.editable.element).on("click","img",function(){return n._openDialog($(this)),!1}),this.options.editable.element.on("halloselected",function(e,i){var o;return o=n.options.editable.options.toolbar,"halloToolbarContextual"===o&&$(i.originalEvent.target).is("img")?(t.hide(),!1):void 0}),t.append(i),this.options.dialog.dialog(this.options.dialogOpts)},_openDialog:function(t){var e,i,o,n,s=this;return this.$image=t,i=this,e=$(this.options.editable.element),o=e.offset().left+e.outerWidth()+10,n=this.$image?this.$image.offset().top-$(document).scrollTop():this.options.toolbar.offset().top-$(document).scrollTop(),this.options.dialog.dialog("option","position",[o,n]),this.options.editable.keepActivated(!0),this.options.dialog.dialog("open"),this.$image?(this.options.dialog.dialog("option","title",this.texts.title_properties),$(document).keyup(function(t){return(46===t.keyCode||8===t.keyCode)&&($(document).off(),i._closeDialog(),i.$image.remove(),i.$image=null),t.preventDefault()}),this.options.editable.element.on("click",function(){return i.$image=null,i._closeDialog()})):(this.options.dialog.children("#hallo_img_properties").hide(),this.options.dialog.dialog("option","title",this.texts.title_insert),$("#hallo_img_file_select_title").length>0&&$("#hallo_img_file_select_title").text("")),this._load_dialog_image_properties_ui(),this.options.dialog.on("dialogclose",function(){var t;return $("label",s.button).removeClass("ui-state-active"),t=$(document).scrollTop(),s.options.editable.element.focus(),$(document).scrollTop(t),s.options.editable.keepActivated(!1)}),this.options.insert_file_dialog_ui_url&&!this.dialog_image_selection_ui_loaded?(this.options.dialog.on("click",".reload_link",function(){return i._load_dialog_image_selection_ui(),!1}),this.options.dialog.on("click",".file_preview img",function(){var t;return i.$image?(t=$(this).attr("src").replace(/-thumb/,""),i.$image.attr("src",t),$("#hallo_img_source").val(t)):i._insert_image($(this).attr("src").replace(/-thumb/,"")),!1}),this._load_dialog_image_selection_ui()):void 0},_insert_image:function(t){return this.options.editable.restoreSelection(this.lastSelection),document.execCommand("insertImage",null,t),this.options.editable.element.trigger("change"),this.options.editable.removeAllSelections(),this._closeDialog()},_closeDialog:function(){return this.options.dialog.dialog("close")},_load_dialog_image_selection_ui:function(){var t;return t=this,$.ajax({url:this.options.insert_file_dialog_ui_url,success:function(e){var i,o,n;return o="",i=t.options.dialog.children("#hallo_img_properties"),i.is(":visible")&&(o=t.texts.change_image),n="<div id='hallo_img_file_select_title'>"+o+"</div>",t.options.dialog.children("#hallo_img_file_select_ui").html(n+e),t.dialog_image_selection_ui_loaded=!0},beforeSend:function(){return t.options.dialog.children("#hallo_img_file_select_ui").html('<div class="hallo_insert_file_loader"></div>')}})},_load_dialog_image_properties_ui:function(){var t,e,i,o,n,s;return n=this,t=this.options.dialog.children("#hallo_img_properties"),this.$image?(s=this.$image.is("[width]")?this.$image.attr("width"):"",i=this.$image.is("[height]")?this.$image.attr("height"):"",o=this._property_input_html("source",this.$image.attr("src"),{label:this.texts.source})+this._property_input_html("alt",this.$image.attr("alt")||"",{label:this.texts.alt})+this._property_row_html(this._property_input_html("width",s,{label:this.texts.width,row:!1})+this._property_input_html("height",i,{label:this.texts.height,row:!1}))+this._property_input_html("padding",this.$image.css("padding"),{label:this.texts.padding})+this._property_row_html(this._property_cb_html("float_left","left"===this.$image.css("float"),{label:this.texts.float_left,row:!1})+this._property_cb_html("float_right","right"===this.$image.css("float"),{label:this.texts.float_right,row:!1})+this._property_cb_html("unfloat","none"===this.$image.css("float"),{label:this.texts.float_none,row:!1}),this.texts.float),t.html(o),t.show()):this.options.insert_file_dialog_ui_url||(t.html(this._property_input_html("source","",{label:this.texts.source})),t.show()),this.$image?(this.options.insert_file_dialog_ui_url||$("#insert_image_btn").remove(),$("#hallo_img_file_select_title").length>0&&$("#hallo_img_file_select_title").text(this.texts.chage_image),$("#hallo_img_properties #hallo_img_source").keyup(function(){return n.$image.attr("src",this.value)}),$("#hallo_img_properties #hallo_img_alt").keyup(function(){return n.$image.attr("alt",this.value)}),$("#hallo_img_properties #hallo_img_padding").keyup(function(){return n.$image.css("padding",this.value)}),$("#hallo_img_properties #hallo_img_height").keyup(function(){return n.$image.css("height",this.value),n.$image.attr("height",this.value)}),$("#hallo_img_properties #hallo_img_width").keyup(function(){return n.$image.css("width",this.value),n.$image.attr("width",this.value)}),$("#hallo_img_properties #hallo_img_float_left").click(function(){return this.checked?(n.$image.css("float","left"),$("#hallo_img_properties #hallo_img_float_right").removeAttr("checked"),$("#hallo_img_properties #hallo_img_unfloat").removeAttr("checked")):!1}),$("#hallo_img_properties #hallo_img_float_right").click(function(){return this.checked?(n.$image.css("float","right"),$("#hallo_img_properties #hallo_img_unfloat").removeAttr("checked"),$("#hallo_img_properties #hallo_img_float_left").removeAttr("checked")):!1}),$("#hallo_img_properties #hallo_img_unfloat").click(function(){return this.checked?(n.$image.css("float","none"),$("#hallo_img_properties #hallo_img_float_right").removeAttr("checked"),$("#hallo_img_properties #hallo_img_float_left").removeAttr("checked")):!1})):this.options.insert_file_dialog_ui_url?void 0:(e='<button id="insert_image_btn">'+this.texts.insert+"</button>",t.after(e),$("#insert_image_btn").click(function(){var t;return t=$("#hallo_img_properties #hallo_img_source"),n._insert_image(t.val())}))},_property_col_html:function(t){return"<div class='hallo_img_property_col'>"+t+"</div>"},_property_row_html:function(t,e){return null==e&&(e=""),t=this._property_col_html(e)+this._property_col_html(t),"<div class='hallo_img_property_row'>"+t+"</div>"},_property_html:function(t,e){var i;return null==e&&(e={}),e.row===!1?(e.label&&(i=""+e.label+" "+t,t="<span class='img_property_entry'>"+i+"</span>"),t):(i="<span class='img_property_entry'>"+t+"</span>",this._property_row_html(i,e.label))},_property_input_html:function(t,e,i){var o;return null==i&&(i={}),o="<input type='text' id='hallo_img_"+t+"' value='"+e+"'>",this._property_html(o,i)},_property_cb_html:function(t,e,i){var o,n;return null==i&&(i={}),n=e?"checked=checked":"",o="<input type='checkbox' id='hallo_img_"+t+"' "+n+"'>",this._property_html(o,i)}}),function(t){return t.widget("IKS.halloblock",{options:{editable:null,toolbar:null,uuid:"",elements:["h1","h2","h3","p","pre","blockquote"],buttonCssClass:null},populateToolbar:function(e){var i,o,n;return i=t('<span class="'+this.widgetName+'"></span>'),o=""+this.options.uuid+"-"+this.widgetName+"-data",n=this._prepareDropdown(o),e.append(i),i.hallobuttonset(),i.append(n),i.append(this._prepareButton(n))},_prepareDropdown:function(e){var i,o,n,s,a,l,r,u=this;for(n=t('<div id="'+e+'"></div>'),o=this.options.editable.element.get(0).tagName.toLowerCase(),i=function(e){var i,n,s;return i=t("<button class='blockselector'>          <"+e+' class="menu-item">'+e+"</"+e+">        </button>"),o===e&&i.addClass("selected"),"div"!==o&&i.addClass("disabled"),i.on("click",function(){var t;return t=e.toUpperCase(),i.hasClass("disabled")?void 0:"Microsoft Internet Explorer"===navigator.appName?void u.options.editable.execute("FormatBlock","<"+t+">"):u.options.editable.execute("formatBlock",t)}),s=function(){var t;return t=document.queryCommandValue("formatBlock"),t.toLowerCase()===e?void i.addClass("selected"):i.removeClass("selected")},n="keyup paste change mouseup",u.options.editable.element.on(n,s),u.options.editable.element.on("halloenabled",function(){return u.options.editable.element.on(n,s)}),u.options.editable.element.on("hallodisabled",function(){return u.options.editable.element.off(n,s)}),i},r=this.options.elements,a=0,l=r.length;l>a;a++)s=r[a],n.append(i(s));return n},_prepareButton:function(e){var i;return i=t("<span></span>"),i.hallodropdownbutton({uuid:this.options.uuid,editable:this.options.editable,label:"block",icon:"icon-text-height",target:e,cssClass:this.options.buttonCssClass}),i}})}(jQuery),function(t){return t.widget("IKS.halloheadings",{options:{editable:null,uuid:"",formatBlocks:["p","h1","h2","h3"],buttonCssClass:null},populateToolbar:function(e){var i,o,n,s,a,l,r,u,h,d=this;for(l=this,o=t('<span class="'+l.widgetName+'"></span>'),a="Microsoft Internet Explorer"===navigator.appName,n=a?"FormatBlock":"formatBlock",i=function(e){var i;return i=t("<span></span>"),i.hallobutton({label:e,editable:d.options.editable,command:n,commandValue:a?"<"+e+">":e,uuid:d.options.uuid,cssClass:d.options.buttonCssClass,queryState:function(){var t,o,s,l,r,u,h,d;try{if(r=document.queryCommandValue(n),a){for(o={p:"normal"},d=[1,2,3,4,5,6],u=0,h=d.length;h>u;u++)l=d[u],o["h"+l]=l;t=r.match(new RegExp(o[e],"i"))}else t=r.match(new RegExp(e,"i"));return s=t?!0:!1,i.hallobutton("checked",s)}catch(c){}}}),i.find("button .ui-button-text").text(e.toUpperCase()),o.append(i)},h=this.options.formatBlocks,r=0,u=h.length;u>r;r++)s=h[r],i(s);return o.hallobuttonset(),e.append(o)}})}(jQuery),function(t){return t.widget("IKS.halloreundo",{options:{editable:null,toolbar:null,uuid:"",buttonCssClass:null},populateToolbar:function(e){var i,o,n=this;return o=t('<span class="'+this.widgetName+'"></span>'),i=function(e,i){var s;return s=t("<span></span>"),s.hallobutton({uuid:n.options.uuid,editable:n.options.editable,label:i,icon:"undo"===e?"icon-undo":"icon-repeat",command:e,queryState:!1,cssClass:n.options.buttonCssClass}),o.append(s)},i("undo","Undo"),i("redo","Redo"),o.hallobuttonset(),e.append(o)}})}(jQuery),function(t){return t.widget("IKS.halloimage",{options:{editable:null,toolbar:null,uuid:"",limit:8,search:null,searchUrl:null,suggestions:null,loaded:null,upload:null,uploadUrl:null,dialogOpts:{autoOpen:!1,width:270,height:"auto",title:"Insert Images",modal:!1,resizable:!1,draggable:!0,dialogClass:"halloimage-dialog"},dialog:null,buttonCssClass:null,entity:null,vie:null,dbPediaUrl:"http://dev.iks-project.eu/stanbolfull",maxWidth:250,maxHeight:250},populateToolbar:function(e){var i,o,n,s,a,l,r;return this.options.toolbar=e,r=this,n=""+this.options.uuid+"-image-dialog",this.options.dialog=t('<div id="'+n+'">        <div class="nav">          <ul class="tabs">          </ul>          <div id="'+this.options.uuid+'-tab-activeIndicator"            class="tab-activeIndicator" />        </div>        <div class="dialogcontent">        </div>'),l=t(".tabs",this.options.dialog),a=t(".dialogcontent",this.options.dialog),r.options.suggestions&&this._addGuiTabSuggestions(l,a),(r.options.search||r.options.searchUrl)&&this._addGuiTabSearch(l,a),(r.options.upload||r.options.uploadUrl)&&this._addGuiTabUpload(l,a),this.current=t('<div class="currentImage"></div>').halloimagecurrent({uuid:this.options.uuid,imageWidget:this,editable:this.options.editable,dialog:this.options.dialog,maxWidth:this.options.maxWidth,maxHeight:this.options.maxHeight}),t(".dialogcontent",this.options.dialog).append(this.current),o=t('<span class="'+r.widgetName+'"></span>'),s=""+this.options.uuid+"-image",i=t("<span></span>"),i.hallobutton({label:"Images",icon:"icon-picture",editable:this.options.editable,command:null,queryState:!1,uuid:this.options.uuid,cssClass:this.options.buttonCssClass}),o.append(i),this.button=i,this.button.on("click",function(){return r.options.dialog.dialog("isOpen")?r._closeDialog():r._openDialog(),!1}),this.options.editable.element.on("hallodeactivated",function(){return r._closeDialog()}),t(this.options.editable.element).delegate("img","click",function(){return r._openDialog()}),e.append(o),this.options.dialog.dialog(this.options.dialogOpts),this._handleTabs()},setCurrent:function(t){return this.current.halloimagecurrent("setImage",t)},_handleTabs:function(){var e;return e=this,t(".nav li",this.options.dialog).on("click",function(){var i,o;return t("."+e.widgetName+"-tab").hide(),i=t(this).attr("id"),t("#"+i+"-content").show(),o=t(this).position().left+t(this).width()/2,t("#"+e.options.uuid+"-tab-activeIndicator").css({"margin-left":o})}),t(".nav li",this.options.dialog).first().click()},_openDialog:function(){var e,i,o,n,s,a,l,r,u=this;return a=this,e=function(){return window.setTimeout(function(){var e;return e=t(".imageThumbnail"),t(e).each(function(){var e;return e=t("#"+this.id).width(),20>=e?t("#"+this.id).parent("li").remove():void 0})},15e3)},n="#"+this.options.uuid+"-tab-suggestions-content",o=function(){return t(".imageThumbnailActive",n).first().attr("src")},t("#"+this.options.uuid+"-sugg-activeImage").attr("src",o()),t("#"+this.options.uuid+"-sugg-activeImageBg").attr("src",o()),this.lastSelection=this.options.editable.getSelection(),i=t(this.options.editable.element),s=t(this.options.toolbar),l=i.offset().left+i.outerWidth()-3,r=s.offset().top+s.outerHeight()+29,r-=t(document).scrollTop(),this.options.dialog.dialog("option","position",[l,r]),e(),a.options.loaded=1,this.options.editable.keepActivated(!0),this.options.dialog.dialog("open"),this.options.dialog.on("dialogclose",function(){return t("label",u.button).removeClass("ui-state-active"),u.options.editable.element.focus(),u.options.editable.keepActivated(!1)})},_closeDialog:function(){return this.options.dialog.dialog("close")},_addGuiTabSuggestions:function(e,i){var o;return e.append(t('<li id="'+this.options.uuid+'-tab-suggestions"        class="'+this.widgetName+"-tabselector "+this.widgetName+'-tab-suggestions">          <span>Suggestions</span>        </li>')),o=t('<div id="'+this.options.uuid+'-tab-suggestions-content"        class="'+this.widgetName+'-tab tab-suggestions"></div>'),i.append(o),o.halloimagesuggestions({uuid:this.options.uuid,imageWidget:this,entity:this.options.entity})},_addGuiTabSearch:function(e,i){var o,n,s;return s=this,o=""+this.options.uuid+"-image-dialog",e.append(t('<li id="'+this.options.uuid+'-tab-search"        class="'+this.widgetName+"-tabselector "+this.widgetName+'-tab-search">          <span>Search</span>        </li>')),n=t('<div id="'+this.options.uuid+'-tab-search-content"        class="'+s.widgetName+'-tab tab-search"></div>'),i.append(n),n.halloimagesearch({uuid:this.options.uuid,imageWidget:this,searchCallback:this.options.search,searchUrl:this.options.searchUrl,limit:this.options.limit,entity:this.options.entity})},_addGuiTabUpload:function(e,i){var o;return e.append(t('<li id="'+this.options.uuid+'-tab-upload"        class="'+this.widgetName+"-tabselector "+this.widgetName+'-tab-upload">          <span>Upload</span>        </li>')),o=t('<div id="'+this.options.uuid+'-tab-upload-content"        class="'+this.widgetName+'-tab tab-upload"></div>'),i.append(o),o.halloimageupload({uuid:this.options.uuid,uploadCallback:this.options.upload,uploadUrl:this.options.uploadUrl,imageWidget:this,entity:this.options.entity})}})}(jQuery),function(t){return t.widget("Liip.hallooverlay",{options:{editable:null,toolbar:null,uuid:"",overlay:null,padding:10,background:null},_create:function(){var e;return e=this,this.options.bound?void 0:(this.options.bound=!0,this.options.editable.element.on("halloactivated",function(i){return e.options.currentEditable=t(i.target),e.options.visible?void 0:e.showOverlay()}),this.options.editable.element.on("hallomodified",function(i){return e.options.currentEditable=t(i.target),e.options.visible?e.resizeOverlay():void 0}),this.options.editable.element.on("hallodeactivated",function(i){return e.options.currentEditable=t(i.target),e.options.visible?e.hideOverlay():void 0}))},showOverlay:function(){return this.options.visible=!0,null===this.options.overlay&&(t("#halloOverlay").length>0?this.options.overlay=t("#halloOverlay"):(this.options.overlay=t('<div id="halloOverlay"            class="halloOverlay">'),t(document.body).append(this.options.overlay)),this.options.overlay.on("click",t.proxy(this.options.editable.turnOff,this.options.editable))),this.options.overlay.show(),null===this.options.background&&(t("#halloBackground").length>0?this.options.background=t("#halloBackground"):(this.options.background=t('<div id="halloBackground"            class="halloBackground">'),t(document.body).append(this.options.background))),this.resizeOverlay(),this.options.background.show(),this.options.originalZIndex||(this.options.originalZIndex=this.options.currentEditable.css("z-index")),this.options.currentEditable.css("z-index","350")},resizeOverlay:function(){var t;return t=this.options.currentEditable.offset(),this.options.background.css({top:t.top-this.options.padding,left:t.left-this.options.padding,width:this.options.currentEditable.width()+2*this.options.padding,height:this.options.currentEditable.height()+2*this.options.padding})},hideOverlay:function(){return this.options.visible=!1,this.options.overlay.hide(),this.options.background.hide(),this.options.currentEditable.css("z-index",this.options.originalZIndex)},_findBackgroundColor:function(t){var e;return e=t.css("background-color"),"rgba(0, 0, 0, 0)"!==e&&"transparent"!==e?e:t.is("body")?"white":this._findBackgroundColor(t.parent())}})}(jQuery),function(t){return t.widget("IKS.halloindicator",{options:{editable:null,className:"halloEditIndicator"},_create:function(){var t=this;return this.element.on("halloenabled",function(){return t.buildIndicator()})},populateToolbar:function(){},buildIndicator:function(){var e;return e=t('<div><i class="icon-edit"></i> Edit</div>'),e.addClass(this.options.className),e.hide(),this.element.before(e),this.bindIndicator(e),this.setIndicatorPosition(e)},bindIndicator:function(e){var i=this;return e.on("click",function(){return i.options.editable.element.focus()}),this.element.on("halloactivated",function(){return e.hide()}),this.element.on("hallodisabled",function(){return e.remove()}),this.options.editable.element.hover(function(){return t(this).hasClass("inEditMode")?void 0:e.show()},function(i){return t(this).hasClass("inEditMode")||i.relatedTarget===e.get(0)?void 0:e.hide()})},setIndicatorPosition:function(t){var e;return t.css("position","absolute"),e=this.element.position(),t.css("top",e.top+2),t.css("left",e.left+2)}})}(jQuery),function(t){var e;return e=null,void 0!==this.VIE&&(e=new VIE,e.use(new e.StanbolService({proxyDisabled:!0,url:"http://dev.iks-project.eu:8081"}))),t.widget("IKS.halloannotate",{options:{vie:e,editable:null,toolbar:null,uuid:"",select:function(){},decline:function(){},remove:function(){},buttonCssClass:null},_create:function(){var e,i,o;if(o=this,void 0===this.options.vie)throw new Error("The halloannotate plugin requires VIE");if("function"!=typeof this.element.annotate)throw new Error("The halloannotate plugin requires annotate.js");return this.state="off",this.instantiate(),i=function(){var e;return e=this,t(e).halloannotate("turnOff")},e=this.options.editable.element,e.on("hallodisabled",i)},populateToolbar:function(e){var i,o=this;return i=t('<span class="'+this.widgetName+'"></span>'),this.button=i.hallobutton({label:"Annotate",icon:"icon-tags",editable:this.options.editable,command:null,uuid:this.options.uuid,cssClass:this.options.buttonCssClass,queryState:!1}),i.on("change",function(){return"pending"!==o.state?"off"===o.state?o.turnOn():o.turnOff():void 0}),i.buttonset(),e.append(this.button)},cleanupContentClone:function(e){return"on"===this.state?e.find(".entity:not([about])").each(function(){return t(this).replaceWith(t(this).html())}):void 0},instantiate:function(){var e;return e=this,this.options.editable.element.annotate({vie:this.options.vie,debug:!1,showTooltip:!0,select:this.options.select,remove:this.options.remove,success:this.options.success,error:this.options.error}).on("annotateselect",function(){return e.options.editable.setModified()}).on("annotateremove",function(){return t.noop()})},turnPending:function(){return this.state="pending",this.button.hallobutton("checked",!1),this.button.hallobutton("disable")},turnOn:function(){var t,e=this;this.turnPending(),t=this;try{return this.options.editable.element.annotate("enable",function(t){return t?(e.state="on",e.button.hallobutton("checked",!0),e.button.hallobutton("enable")):void 0})}catch(i){return alert(i)}},turnOff:function(){return this.options.editable.element.annotate("disable"),this.state="off",this.button?(this.button.attr("checked",!1),this.button.find("label").removeClass("ui-state-clicked"),this.button.button("refresh")):void 0}})}(jQuery),function(t){return t.widget("IKS.halloimagesearch",{options:{imageWidget:null,searchCallback:null,searchUrl:null,limit:5},_create:function(){return this.element.html('<div>        <form method="get">          <input type="text" class="searchInput" placeholder="Search" />          <input type="submit" class="btn searchButton" value="OK" />        </form>        <div class="searchResults imageThumbnailContainer">          <div class="activitySpinner">Loading images...</div>          <ul></ul>        </div>      </div>')},_init:function(){var e=this;return this.options.searchUrl&&!this.options.searchCallback&&(this.options.searchCallback=this._ajaxSearch),t(".activitySpinner",this.element).hide(),t("form",this.element).submit(function(i){var o;return i.preventDefault(),t(".activitySpinner",e.element).show(),o=t(".searchInput",e.element.element).val(),e.options.searchCallback(o,e.options.limit,0,function(t){return e._showResults(t)})})},_showResult:function(e){var i,o=this;return e.label||(e.label=e.alt),i=t('<li>        <img src="'+e.url+'" class="imageThumbnail"          title="'+e.label+'"></li>'),i.on("click",function(){return o.options.imageWidget.setCurrent(e)}),t("img",i).on("mousedown",function(t){return t.preventDefault(),o.options.imageWidget.setCurrent(e)}),t(".imageThumbnailContainer ul",this.element).append(i)},_showNextPrev:function(e){var i,o=this;return i=t("imageThumbnailContainer ul",this.element),i.prepend(t('<div class="pager-prev" style="display:none" />')),i.append(t('<div class="pager-next" style="display:none" />')),e.offset>0&&t(".pager-prev",i).show(),e.offset<e.total&&t(".pager-next",i).show(),t(".pager-prev",i).click(function(){var t;return t=e.offset-o.options.limit,o.options.searchCallback(query,o.options.limit,t,function(t){return o._showResults(t)})}),t(".pager-next",i).click(function(){var t;return t=e.offset+o.options.limit,o.options.searchCallback(query,o.options.limit,t,function(t){return o._showResults(t)})})},_showResults:function(e){var i,o,n,s;for(t(".activitySpinner",this.element).hide(),t(".imageThumbnailContainer ul",this.element).empty(),t(".imageThumbnailContainer ul",this.element).show(),s=e.assets,o=0,n=s.length;n>o;o++)i=s[o],this._showResult(i);return this.options.imageWidget.setCurrent(e.assets.shift()),this._showNextPrev(e)},_ajaxSearch:function(e,i,o,n){var s;return s=this.searchUrl+"?"+t.param({q:e,limit:i,offset:o}),t.getJSON(s,n)}})}(jQuery),function(t){return t.widget("IKS.halloimageupload",{options:{uploadCallback:null,uploadUrl:null,imageWidget:null,entity:null},_create:function(){return this.element.html('        <form class="upload">        <input type="file" class="file" name="userfile" accept="image/*" />        <input type="hidden" name="tags" value="" />        <input type="text" class="caption" name="caption" placeholder="Title" />        <button class="uploadSubmit">Upload</button>        </form>      ')},_init:function(){var e;return e=this,e.options.uploadUrl&&!e.options.uploadCallback&&(e.options.uploadCallback=e._iframeUpload),t(".uploadSubmit",this.element).on("click",function(t){return t.preventDefault(),t.stopPropagation(),e.options.uploadCallback({widget:e,success:function(t){return e.options.imageWidget.setCurrent({url:t,label:""})}})})},_prepareIframe:function(e){var i,o;return o=""+e.widgetName+"_postframe_"+e.options.uuid,o=o.replace(/-/g,"_"),i=t("#"+o),i.length?i:(i=t('<iframe name="'+o+'" id="'+o+'"        class="hidden" style="display:none" />'),this.element.append(i),i.get(0).name=o,i)},_iframeUpload:function(e){var i,o,n,s;return s=e.widget,i=s._prepareIframe(s),o=t("form.upload",s.element),n="function"==typeof s.options.uploadUrl?s.options.uploadUrl(s.options.entity):s.options.uploadUrl,i.on("load",function(){var t;return t=i.get(0).contentWindow.location.href,s.element.hide(),e.success(t)}),o.attr("action",n),o.attr("method","post"),o.attr("target",i.get(0).name),o.attr("enctype","multipart/form-data"),o.attr("encoding","multipart/form-data"),o.submit()
}})}(jQuery),function(t){return t.widget("IKS.halloimagesuggestions",{loaded:!1,options:{entity:null,vie:null,dbPediaUrl:null,getSuggestions:null,thumbnailUri:"<http://dbpedia.org/ontology/thumbnail>"},_create:function(){return this.element.html('      <div id="'+this.options.uuid+'-tab-suggestions">        <div class="imageThumbnailContainer">          <div class="activitySpinner">Loading images...</div>          <ul></ul>        </div>      </div>')},_init:function(){return t(".activitySpinner",this.element).hide()},_normalizeRelated:function(t){return _.isString(t)?t:_.isArray(t)?t.join(","):t.pluck("@subject").join(",")},_prepareVIE:function(){return this.options.vie||(this.options.vie=new VIE),!this.options.vie.services.dbpedia&&this.options.dbPediaUrl?this.options.vie.use(new vie.DBPediaService({url:this.options.dbPediaUrl,proxyDisabled:!0})):void 0},_getSuggestions:function(){var e,i,o;if(!this.loaded&&this.options.entity)return t(".activitySpinner",this.element).show(),o=this.options.entity.get("skos:related"),0===o.length?void t("#activitySpinner").html("No images found."):(t(".imageThumbnailContainer ul",this.element).empty(),i=this._normalizeRelated(o),e=this.options.limit,this.options.getSuggestions&&this.options.getSuggestions(i,e,0,this._showSuggestions),this._prepareVIE(),this.options.vie.services.dbpedia&&this._getSuggestionsDbPedia(o),this.loaded=!0)},_getSuggestionsDbPedia:function(e){var i,o;return o=this,i=1,_.each(e,function(e){return vie.load({entity:e}).using("dbpedia").execute().done(function(i){return t(".activitySpinner",this.element).hide(),_.each(i,function(t){var i,n;return(n=t.attributes[o.options.thumbnailUri])?(_.isObject(n)&&(i=n[0].value),_.isString(n)&&(i=o.options.entity.fromReference(n)),o._showSuggestion({url:i,label:e})):void 0})})})},_showSuggestion:function(e){var i,o=this;return i=t('<li>        <img src="'+e.url+'" class="imageThumbnail"          title="'+e.label+'">        </li>'),i.on("click",function(){return o.options.imageWidget.setCurrent(e)}),t(".imageThumbnailContainer ul",this.element).append(i)},_showSuggestions:function(e){var i=this;return t(".activitySpinner",this.element).hide(),_.each(e,function(t){return i._showSuggestion(t)})}})}(jQuery),function(t){return t.widget("IKS.halloimagecurrent",{options:{imageWidget:null,startPlace:"",draggables:[],maxWidth:400,maxHeight:200},_create:function(){return this.element.html('<div>        <div class="activeImageContainer">          <div class="rotationWrapper">            <div class="hintArrow"></div>              <img src="" class="activeImage" />            </div>            <img src="" class="activeImage activeImageBg" />          </div>        </div>'),this.element.hide(),this._prepareDnD()},_init:function(){var e,i;return e=t(this.options.editable.element),i=this,t("img",e).each(function(t,o){return i._initDraggable(o,e)}),t("p",e).each(function(e,o){return t(o).data("jquery_droppable_initialized")?void 0:(t(o).droppable({tolerance:"pointer",drop:function(t,e){return i._handleDropEvent(t,e)},over:function(t,e){return i._handleOverEvent(t,e)},out:function(t,e){return i._handleLeaveEvent(t,e)}}),t(o).data("jquery_droppable_initialized",!0))})},_prepareDnD:function(){var e,i,o;return o=this,e=t(this.options.editable.element),this.options.offset=e.offset(),this.options.third=parseFloat(e.width()/3),i={width:this.options.third,height:e.height()},this.overlay={big:t("<div/>").addClass("bigOverlay").css({width:2*this.options.third,height:e.height()}),left:t("<div/>").addClass("smallOverlay smallOverlayLeft"),right:t("<div/>").addClass("smallOverlay smallOverlayRight")},this.overlay.left.css(i),this.overlay.right.css(i).css("left",2*this.options.third),e.on("halloactivated",function(){return o._enableDragging()}),e.on("hallodeactivated",function(){return o._disableDragging()})},setImage:function(e){return e?(this.element.show(),t(".activeImage",this.element).attr("src",e.url),e.label&&t("input",this.element).val(e.label),this._initImage(t(this.options.editable.element))):void 0},_delayAction:function(t,e){var i;return i=clearTimeout(i),i?void 0:i=setTimeout(t,e)},_calcDropPosition:function(t,e){var i,o;return i=t.left+this.options.third,o=t.left+2*this.options.third,e.pageX>=i&&e.pageX<=o?"middle":e.pageX<i?"left":e.pageX>o?"right":void 0},_createInsertElement:function(e,i){var o,n;return o=t("<img>"),n=new Image,t(n).on("load",function(){}),n.src=e.src,o.attr({src:n.src,alt:i?void 0:t(e).attr("alt"),"class":i?"halloTmp":"imageInText"}),o.show(),o},_createLineFeedbackElement:function(){return t("<div/>").addClass("halloTmpLine")},_removeFeedbackElements:function(){return this.overlay.big.remove(),this.overlay.left.remove(),this.overlay.right.remove(),t(".halloTmp, .halloTmpLine",this.options.editable.element).remove()},_removeCustomHelper:function(){return t(".customHelper").remove()},_showOverlay:function(e){var i,o;switch(o=t(this.options.editable.element),i=o.height(),i+=parseFloat(o.css("paddingTop")),i+=parseFloat(o.css("paddingBottom")),this.overlay.big.css({height:i}),this.overlay.left.css({height:i}),this.overlay.right.css({height:i}),e){case"left":return this.overlay.big.addClass("bigOverlayLeft"),this.overlay.big.removeClass("bigOverlayRight"),this.overlay.big.css({left:this.options.third}),this.overlay.big.show(),this.overlay.left.hide(),this.overlay.right.hide();case"middle":return this.overlay.big.removeClass("bigOverlayLeft bigOverlayRight"),this.overlay.big.hide(),this.overlay.left.show(),this.overlay.right.show();case"right":return this.overlay.big.addClass("bigOverlayRight"),this.overlay.big.removeClass("bigOverlayLeft"),this.overlay.big.css({left:0}),this.overlay.big.show(),this.overlay.left.hide(),this.overlay.right.hide()}},_checkOrigin:function(e){return 0!==t(e.target).parents("[contenteditable]").length?!0:!1},_createFeedback:function(t,e){var i;return"middle"===e?this._createLineFeedbackElement():(i=this._createInsertElement(t,!0),i.addClass("inlineImage-"+e))},_handleOverEvent:function(e,i){var o,n,s;return s=this,o=t(this.options.editable),n=function(){var n,a;return window.waitWithTrash=clearTimeout(window.waitWithTrash),n=s._calcDropPosition(s.options.offset,e),t(".trashcan",i.helper).remove(),o[0].element.append(s.overlay.big),o[0].element.append(s.overlay.left),o[0].element.append(s.overlay.right),s._removeFeedbackElements(),a=t(e.target),a.prepend(s._createFeedback(i.draggable[0],n)),"middle"===n?(a.prepend(s._createFeedback(i.draggable[0],"right")),t(".halloTmp",e.target).hide()):(a.prepend(s._createFeedback(i.draggable[0],"middle")),t(".halloTmpLine",e.target).hide()),s._showOverlay(n)},setTimeout(n,5)},_handleDragEvent:function(e){var i,o,n;return i=this._calcDropPosition(this.options.offset,e),i!==this._lastPositionDrag?(this._lastPositionDrag=i,o=t(".halloTmp",this.options.editable.element),n=t(".halloTmpLine",this.options.editable.element),"middle"===i?(n.show(),o.hide()):(n.hide(),o.removeClass("inlineImage-left inlineImage-right"),o.addClass("inlineImage-"+i),o.show()),this._showOverlay(i)):void 0},_handleLeaveEvent:function(e,i){var o;return o=function(){return t("div.trashcan",i.helper).length?void 0:(t(i.helper).append(t('<div class="trashcan"></div>')),t(".bigOverlay, .smallOverlay").remove())},window.waitWithTrash=setTimeout(o,200),this._removeFeedbackElements()},_handleStartEvent:function(e){var i;return i=this._checkOrigin(e),i&&t(e.target).remove(),t(document).trigger("startPreventSave"),this.options.startPlace=t(e.target)},_handleStopEvent:function(e){var i;return i=this._checkOrigin(e),i?t(e.target).remove():t(this.options.editable.element).trigger("change"),this.overlay.big.hide(),this.overlay.left.hide(),this.overlay.right.hide(),t(document).trigger("stopPreventSave")},_handleDropEvent:function(e,i){var o,n,s,a,l,r;return n=t(this.options.editable.element),a=this._checkOrigin(e),r=this._calcDropPosition(this.options.offset,e),this._removeFeedbackElements(),this._removeCustomHelper(),s=this._createInsertElement(i.draggable[0],!1),o="inlineImage-middle inlineImage-left inlineImage-right","middle"===r?(s.show(),s.removeClass(o),l=n.width(),l+=parseFloat(n.css("paddingLeft")),l+=parseFloat(n.css("paddingRight")),l-=s.attr("width"),s.addClass("inlineImage-"+r).css({position:"relative",left:l/2}),s.insertBefore(t(e.target))):(s.removeClass(o),s.addClass("inlineImage-"+r),s.css("display","block"),t(e.target).prepend(s)),this.overlay.big.hide(),this.overlay.left.hide(),this.overlay.right.hide(),n.trigger("change"),this._initImage(n)},_createHelper:function(e){return t("<div>").css({backgroundImage:"url("+t(e.currentTarget).attr("src")+")"}).addClass("customHelper").appendTo("body")},_initDraggable:function(e,i){var o;return o=this,e.jquery_draggable_initialized||(e.jquery_draggable_initialized=!0,t(e).draggable({cursor:"move",helper:function(t){return o._createHelper(t)},drag:function(t,e){return o._handleDragEvent(t,e)},start:function(t,e){return o._handleStartEvent(t,e)},stop:function(t,e){return o._handleStopEvent(t,e)},disabled:!i.hasClass("inEditMode"),cursorAt:{top:50,left:50}})),o.options.draggables.push(e)},_initImage:function(e){var i;return i=this,t(".rotationWrapper img",this.options.dialog).each(function(t,o){return i._initDraggable(o,e)})},_enableDragging:function(){return t.each(this.options.draggables,function(e,i){return t(i).draggable("option","disabled",!1)})},_disableDragging:function(){return t.each(this.options.draggables,function(e,i){return t(i).draggable("option","disabled",!0)})}})}(jQuery),function(t){return t.widget("IKS.hallojustify",{options:{editable:null,toolbar:null,uuid:"",buttonCssClass:null},populateToolbar:function(e){var i,o,n=this;return o=t('<span class="'+this.widgetName+'"></span>'),i=function(e){var i;return i=t("<span></span>"),i.hallobutton({uuid:n.options.uuid,editable:n.options.editable,label:e,command:"justify"+e,icon:"icon-align-"+e.toLowerCase(),cssClass:n.options.buttonCssClass}),o.append(i)},i("Left"),i("Center"),i("Right"),o.hallobuttonset(),e.append(o)}})}(jQuery),function(t){return t.widget("IKS.halloblacklist",{options:{tags:[]},_init:function(){return-1!==this.options.tags.indexOf("br")?this.element.on("keydown",function(t){return 13===t.originalEvent.keyCode?t.preventDefault():void 0}):void 0},cleanupContentClone:function(e){var i,o,n,s,a;for(s=this.options.tags,a=[],o=0,n=s.length;n>o;o++)i=s[o],a.push(t(i,e).remove());return a}})}(jQuery),function(t){return t.widget("Liip.hallotoolbarlinebreak",{options:{editable:null,uuid:"",breakAfter:[]},populateToolbar:function(e){var i,o,n,s,a,l,r,u,h,d,c;for(n=t(".ui-buttonset",e),s=t(),l=0,c=this.options.breakAfter,r=0,h=c.length;h>r;r++)for(a=c[r],l++,i='<div          class="halloButtonrow halloButtonrow-'+l+'" />',u=0,d=n.length;d>u;u++)if(o=n[u],s=t(s).add(t(o)),t(o).hasClass(a)){s.wrapAll(i),n=n.not(s),s=t();break}return n.length>0?(l++,i='<div          class="halloButtonrow halloButtonrow-'+l+'" />',n.wrapAll(i)):void 0}})}(jQuery),function(t){return t.widget("IKS.hallobutton",{button:null,isChecked:!1,options:{uuid:"",label:null,icon:null,editable:null,command:null,commandValue:null,queryState:!0,cssClass:null},_create:function(){var t,e,i,o,n,s=this;return null==(n=(o=this.options).icon)&&(o.icon="icon-"+this.options.label.toLowerCase()),e=""+this.options.uuid+"-"+this.options.label,i=this.options,this.button=this._createButton(e,i.command,i.label,i.icon),this.element.append(this.button),this.options.cssClass&&this.button.addClass(this.options.cssClass),this.options.editable.options.touchScreen&&this.button.addClass("btn-large"),this.button.data("hallo-command",this.options.command),this.options.commandValue&&this.button.data("hallo-command-value",this.options.commandValue),t="ui-state-hover",this.button.on("mouseenter",function(){return s.isEnabled()?s.button.addClass(t):void 0}),this.button.on("mouseleave",function(){return s.button.removeClass(t)})},_init:function(){var t,e,i,o=this;return this.button||(this.button=this._prepareButton()),this.element.append(this.button),i=this.options.queryState===!0?function(){var t,e;if(o.options.command)try{return o.options.commandValue?(e=document.queryCommandValue(o.options.command),t=e.match(new RegExp(o.options.commandValue,"i")),o.checked(t?!0:!1)):o.checked(document.queryCommandState(o.options.command))}catch(i){}}:this.options.queryState,this.options.command&&this.button.on("click",function(){return o.options.commandValue?o.options.editable.execute(o.options.command,o.options.commandValue):o.options.editable.execute(o.options.command),i(),!1}),this.options.queryState?(t=this.options.editable.element,e="keyup paste change mouseup hallomodified",t.on(e,i),t.on("halloenabled",function(){return t.on(e,i)}),t.on("hallodisabled",function(){return t.off(e,i)})):void 0},enable:function(){return this.button.removeAttr("disabled")},disable:function(){return this.button.attr("disabled","true")},isEnabled:function(){return"true"!==this.button.attr("disabled")},refresh:function(){return this.isChecked?this.button.addClass("ui-state-active"):this.button.removeClass("ui-state-active")},checked:function(t){return this.isChecked=t,this.refresh()},_createButton:function(e,i,o,n){var s;return s=["ui-button","ui-widget","ui-state-default","ui-corner-all","ui-button-text-only",""+i+"_button"],t('<button id="'+e+'"        class="'+s.join(" ")+'" title="'+o+'">          <span class="ui-button-text">            <i class="'+n+'"></i>          </span>        </button>')}}),t.widget("IKS.hallobuttonset",{buttons:null,_create:function(){return this.element.addClass("ui-buttonset")},_init:function(){return this.refresh()},refresh:function(){var t;return t="rtl"===this.element.css("direction"),this.buttons=this.element.find(".ui-button"),this.buttons.removeClass("ui-corner-all ui-corner-left ui-corner-right"),t?(this.buttons.filter(":first").addClass("ui-corner-right"),this.buttons.filter(":last").addClass("ui-corner-left")):(this.buttons.filter(":first").addClass("ui-corner-left"),this.buttons.filter(":last").addClass("ui-corner-right"))}})}(jQuery),function(t){return t.widget("IKS.hallodropdownbutton",{button:null,options:{uuid:"",label:null,icon:null,editable:null,target:"",cssClass:null},_create:function(){var t,e;return null!=(e=(t=this.options).icon)?e:t.icon="icon-"+this.options.label.toLowerCase()},_init:function(){var e,i=this;return e=t(this.options.target),e.css("position","absolute"),e.addClass("dropdown-menu"),e.hide(),this.button||(this.button=this._prepareButton()),this.button.on("click",function(){return e.hasClass("open")?void i._hideTarget():i._showTarget()}),e.on("click",function(){return i._hideTarget()}),this.options.editable.element.on("hallodeactivated",function(){return i._hideTarget()}),this.element.append(this.button)},_showTarget:function(){var e;return e=t(this.options.target),this._updateTargetPosition(),e.addClass("open"),e.show()},_hideTarget:function(){var e;return e=t(this.options.target),e.removeClass("open"),e.hide()},_updateTargetPosition:function(){var e,i,o,n;return i=t(this.options.target),n=this.button.position(),o=n.top,e=n.left,o+=this.button.outerHeight(),i.css("top",o),i.css("left",e-20)},_prepareButton:function(){var e,i,o;return o=""+this.options.uuid+"-"+this.options.label,i=["ui-button","ui-widget","ui-state-default","ui-corner-all","ui-button-text-only"],e=t('<button id="'+o+'"       class="'+i.join(" ")+'" title="'+this.options.label+'">       <span class="ui-button-text"><i class="'+this.options.icon+'"></i></span>       </button>'),this.options.cssClass&&e.addClass(this.options.cssClass),e}})}(jQuery),function(t){return t.widget("IKS.halloToolbarFixed",{toolbar:null,options:{parentElement:"body",editable:null,toolbar:null,affix:!0,affixTopOffset:2},_create:function(){var e,i,o=this;return this.toolbar=this.options.toolbar,this.toolbar.show(),t(this.options.parentElement).append(this.toolbar),this._bindEvents(),t(window).resize(function(){return o.setPosition()}),t(window).scroll(function(){return o.setPosition()}),"body"===this.options.parentElement?(e=t(this.element),i=parseFloat(e.css("padding-left")),i+=parseFloat(e.css("padding-right")),i+=parseFloat(e.css("border-left-width")),i+=parseFloat(e.css("border-right-width")),i+=2*parseFloat(e.css("outline-width")),i+=2*parseFloat(e.css("outline-offset")),t(this.toolbar).css("width",e.width()+i)):void 0},_getPosition:function(t){var e,i,o;if(t)return o=parseFloat(this.element.css("outline-width")),e=o+parseFloat(this.element.css("outline-offset")),i={top:this.element.offset().top-this.toolbar.outerHeight()-e,left:this.element.offset().left-e}},_getCaretPosition:function(e){var i,o,n;return n=t("<span/>"),i=rangy.createRange(),i.setStart(e.endContainer,e.endOffset),i.insertNode(n.get(0)),o={top:n.offset().top,left:n.offset().left},n.remove(),o},setPosition:function(){var e,i,o,n,s,a;if("body"===this.options.parentElement)return this.toolbar.css("position","absolute"),this.toolbar.css("top",this.element.offset().top-this.toolbar.outerHeight()),this.options.affix&&(s=t(window).scrollTop(),n=this.element.offset(),o=this.element.height(),a=this.options.affixTopOffset,i=n.top-(this.toolbar.height()+this.options.affixTopOffset),e=o-a+(n.top-this.toolbar.height()),s>i&&e>s&&(this.toolbar.css("position","fixed"),this.toolbar.css("top",this.options.affixTopOffset))),this.toolbar.css("left",this.element.offset().left-2)},_updatePosition:function(){},_bindEvents:function(){var t=this;return this.element.on("halloactivated",function(){return t.setPosition(),t.toolbar.show()}),this.element.on("hallodeactivated",function(){return t.toolbar.hide()})}})}(jQuery),function(t){return t.widget("IKS.halloToolbarContextual",{toolbar:null,options:{parentElement:"body",editable:null,toolbar:null,positionAbove:!1},_create:function(){var e=this;return this.toolbar=this.options.toolbar,t(this.options.parentElement).append(this.toolbar),this._bindEvents(),t(window).resize(function(t){return e._updatePosition(e._getPosition(t))})},_getPosition:function(t,e){var i,o;if(t)switch(i=t.type){case"keydown":case"keyup":case"keypress":return this._getCaretPosition(e);case"click":case"mousedown":case"mouseup":return o={top:t.pageY,left:t.pageX}}},_getCaretPosition:function(e){var i,o,n;return n=t("<span/>"),i=rangy.createRange(),i.setStart(e.endContainer,e.endOffset),i.insertNode(n.get(0)),o={top:n.offset().top,left:n.offset().left},n.remove(),o},setPosition:function(){return"body"!==this.options.parentElement&&(this.options.parentElement="body",t(this.options.parentElement).append(this.toolbar)),this.toolbar.css("position","absolute"),this.toolbar.css("top",this.element.offset().top-20),this.toolbar.css("left",this.element.offset().left)},_updatePosition:function(e,i){var o,n,s,a,l;return null==i&&(i=null),e&&e.top&&e.left?(s=this.toolbar.outerHeight()+10,i&&!i.collapsed&&i.nativeRange?(n=i.nativeRange.getBoundingClientRect(),l=this.options.positionAbove?n.top-s:n.bottom+10,a=t(window).scrollTop()+l,o=t(window).scrollLeft()+n.left):(l=this.options.positionAbove?-10-s:20,a=e.top+l,o=e.left-this.toolbar.outerWidth()/2+30),this.toolbar.css("top",a),this.toolbar.css("left",o)):void 0},_bindEvents:function(){var t=this;return this.element.on("halloselected",function(e,i){var o;return(o=t._getPosition(i.originalEvent,i.selection))?(t._updatePosition(o,i.selection),""!==t.toolbar.html()?t.toolbar.show():void 0):void 0}),this.element.on("hallounselected",function(){return t.toolbar.hide()}),this.element.on("hallodeactivated",function(){return t.toolbar.hide()})}})}(jQuery),function(t){return t.widget("IKS.hallo",{toolbar:null,bound:!1,originalContent:"",previousContent:"",uuid:"",selection:null,_keepActivated:!1,originalHref:null,options:{editable:!0,plugins:{},toolbar:"halloToolbarContextual",parentElement:"body",buttonCssClass:null,toolbarCssClass:null,toolbarPositionAbove:!1,toolbarOptions:{},placeholder:"",forceStructured:!0,checkTouch:!0,touchScreen:null},_create:function(){var e,i,o,n=this;this.id=this._generateUUID(),this.options.checkTouch&&null===this.options.touchScreen&&this.checkTouch(),o=this.options.plugins;for(i in o)e=o[i],t.isPlainObject(e)||(e={}),t.extend(e,{editable:this,uuid:this.id,buttonCssClass:this.options.buttonCssClass}),t(this.element)[i](e);return this.element.one("halloactivated",function(){return n._prepareToolbar()}),this.originalContent=this.getContents()},_init:function(){return this.options.editable?this.enable():this.disable()},destroy:function(){var e,i,o;this.disable(),this.toolbar&&(this.toolbar.remove(),this.element[this.options.toolbar]("destroy")),o=this.options.plugins;for(i in o)e=o[i],t(this.element)[i]("destroy");return t.Widget.prototype.destroy.call(this)},disable:function(){var e=this;return this.element.attr("contentEditable",!1),this.element.off("focus",this._activated),this.element.off("blur",this._deactivated),this.element.off("keyup paste change",this._checkModified),this.element.off("keyup",this._keys),this.element.off("keyup mouseup",this._checkSelection),this.bound=!1,t(this.element).removeClass("isModified"),t(this.element).removeClass("inEditMode"),this.element.parents("a").andSelf().each(function(i,o){var n;return n=t(o),n.is("a")&&e.originalHref?n.attr("href",e.originalHref):void 0}),this._trigger("disabled",null)},enable:function(){var e=this;return this.element.parents("a[href]").andSelf().each(function(i,o){var n;return n=t(o),n.is("a[href]")?(e.originalHref=n.attr("href"),n.removeAttr("href")):void 0}),this.element.attr("contentEditable",!0),this.element.html().trim()||(this.element.html(this.options.placeholder),this.element.css({"min-width":this.element.innerWidth(),"min-height":this.element.innerHeight()})),this.bound||(this.element.on("focus",this,this._activated),this.element.on("blur",this,this._deactivated),this.element.on("keyup paste change",this,this._checkModified),this.element.on("keyup",this,this._keys),this.element.on("keyup mouseup",this,this._checkSelection),this.bound=!0),this.options.forceStructured&&this._forceStructured(),this._trigger("enabled",null)},activate:function(){return this.element.focus()},containsSelection:function(){var t;return t=this.getSelection(),this.element.has(t.startContainer).length>0},getSelection:function(){var t,e;return e=rangy.getSelection(),t=null,t=e.rangeCount>0?e.getRangeAt(0):rangy.createRange()},restoreSelection:function(t){var e;return e=rangy.getSelection(),e.setSingleRange(t)},replaceSelection:function(t){var e,i,o,n,s;return"Microsoft Internet Explorer"===navigator.appName?(s=document.selection.createRange().text,i=document.selection.createRange(),i.pasteHTML(t(s))):(n=window.getSelection(),o=n.getRangeAt(0),e=document.createTextNode(t(o.extractContents())),o.insertNode(e),o.setStartAfter(e),n.removeAllRanges(),n.addRange(o))},removeAllSelections:function(){return"Microsoft Internet Explorer"===navigator.appName?range.empty():window.getSelection().removeAllRanges()},getContents:function(){var e,i,o;i=this.element.clone();for(o in this.options.plugins)e=t(this.element).data("IKS-"+o).cleanupContentClone,t.isFunction(e)&&t(this.element)[o]("cleanupContentClone",i);return i.html()},setContents:function(t){return this.element.html(t)},isModified:function(){return this.previousContent||(this.previousContent=this.originalContent),this.previousContent!==this.getContents()},setUnmodified:function(){return t(this.element).removeClass("isModified"),this.previousContent=this.getContents()},setModified:function(){return t(this.element).addClass("isModified"),this._trigger("modified",null,{editable:this,content:this.getContents()})},restoreOriginalContent:function(){return this.element.html(this.originalContent)},execute:function(t,e){return document.execCommand(t,!1,e)?this.element.trigger("change"):void 0},protectFocusFrom:function(t){var e=this;return t.on("mousedown",function(t){return t.preventDefault(),e._protectToolbarFocus=!0,setTimeout(function(){return e._protectToolbarFocus=!1},300)})},keepActivated:function(t){this._keepActivated=t},_generateUUID:function(){var t;return t=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},""+t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},_prepareToolbar:function(){var e,i,o,n;this.toolbar=t('<div class="hallotoolbar"></div>').hide(),this.options.toolbarCssClass&&this.toolbar.addClass(this.options.toolbarCssClass),e={editable:this,parentElement:this.options.parentElement,toolbar:this.toolbar,positionAbove:this.options.toolbarPositionAbove},n=$.extend({},e,this.options.toolbarOptions),this.element[this.options.toolbar](n);for(i in this.options.plugins)o=t(this.element).data("IKS-"+i).populateToolbar,t.isFunction(o)&&this.element[i]("populateToolbar",this.toolbar);return this.element[this.options.toolbar]("setPosition"),this.protectFocusFrom(this.toolbar)},changeToolbar:function(t,e,i){var o;return null==i&&(i=!1),o=this.options.toolbar,this.options.parentElement=t,e&&(this.options.toolbar=e),this.toolbar?(this.element[o]("destroy"),this.toolbar.remove(),this._prepareToolbar(),i?this.toolbar.hide():void 0):void 0},_checkModified:function(t){var e;return e=t.data,e.isModified()?e.setModified():void 0},_keys:function(t){var e,i;return i=t.data,27===t.keyCode?(e=i.getContents(),i.restoreOriginalContent(t),i._trigger("restored",null,{editable:i,content:i.getContents(),thrown:e}),i.turnOff()):void 0},_rangesEqual:function(t,e){return t.startContainer!==e.startContainer?!1:t.startOffset!==e.startOffset?!1:t.endContainer!==e.endContainer?!1:t.endOffset!==e.endOffset?!1:!0},_checkSelection:function(t){var e;if(27!==t.keyCode)return e=t.data,setTimeout(function(){var i;return i=e.getSelection(),e._isEmptySelection(i)||e._isEmptyRange(i)?void(e.selection&&(e.selection=null,e._trigger("unselected",null,{editable:e,originalEvent:t}))):e.selection&&e._rangesEqual(i,e.selection)?void 0:(e.selection=i.cloneRange(),e._trigger("selected",null,{editable:e,selection:e.selection,ranges:[e.selection],originalEvent:t}))},0)},_isEmptySelection:function(t){return"Caret"===t.type?!0:!1},_isEmptyRange:function(t){return t.collapsed?!0:t.isCollapsed?"function"==typeof t.isCollapsed?t.isCollapsed():t.isCollapsed:!1},turnOn:function(){return this.getContents()===this.options.placeholder&&this.setContents(""),t(this.element).addClass("inEditMode"),this._trigger("activated",null,this)},turnOff:function(){return t(this.element).removeClass("inEditMode"),this._trigger("deactivated",null,this),this.getContents()?void 0:this.setContents(this.options.placeholder)},_activated:function(t){return t.data.turnOn()},_deactivated:function(e){return e.data._keepActivated?void 0:e.data._protectToolbarFocus!==!0?e.data.turnOff():setTimeout(function(){return t(e.data.element).focus()},300)},_forceStructured:function(){try{return document.execCommand("styleWithCSS",0,!1)}catch(t){try{return document.execCommand("useCSS",0,!0)}catch(t){try{return document.execCommand("styleWithCSS",!1,!1)}catch(t){}}}},checkTouch:function(){return this.options.touchScreen=!!("createTouch"in document)}})}(jQuery)}).call(this);