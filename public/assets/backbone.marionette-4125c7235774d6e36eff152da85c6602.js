var Marionette=function(e,t,i){"use strict";function n(e,t){var i=new Error(e);throw i.name=t||"Error",i}!function(e,t){var i=e.ChildViewContainer;return e.ChildViewContainer=function(e,t){var i=function(e){this._views={},this._indexByModel={},this._indexByCustom={},this._updateLength(),t.each(e,this.add,this)};t.extend(i.prototype,{add:function(e,t){var i=e.cid;return this._views[i]=e,e.model&&(this._indexByModel[e.model.cid]=i),t&&(this._indexByCustom[t]=i),this._updateLength(),this},findByModel:function(e){return this.findByModelCid(e.cid)},findByModelCid:function(e){var t=this._indexByModel[e];return this.findByCid(t)},findByCustom:function(e){var t=this._indexByCustom[e];return this.findByCid(t)},findByIndex:function(e){return t.values(this._views)[e]},findByCid:function(e){return this._views[e]},remove:function(e){var i=e.cid;return e.model&&delete this._indexByModel[e.model.cid],t.any(this._indexByCustom,function(e,t){return e===i?(delete this._indexByCustom[t],!0):void 0},this),delete this._views[i],this._updateLength(),this},call:function(e){this.apply(e,t.tail(arguments))},apply:function(e,i){t.each(this._views,function(n){t.isFunction(n[e])&&n[e].apply(n,i||[])})},_updateLength:function(){this.length=t.size(this._views)}});var n=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];return t.each(n,function(e){i.prototype[e]=function(){var i=t.values(this._views),n=[i].concat(t.toArray(arguments));return t[e].apply(t,n)}}),i}(e,t),e.ChildViewContainer.VERSION="0.1.4",e.ChildViewContainer.noConflict=function(){return e.ChildViewContainer=i,this},e.ChildViewContainer}(t,i),function(e,t){var i=e.Wreqr,n=e.Wreqr={};return e.Wreqr.VERSION="1.3.1",e.Wreqr.noConflict=function(){return e.Wreqr=i,this},n.Handlers=function(e,t){var i=function(e){this.options=e,this._wreqrHandlers={},t.isFunction(this.initialize)&&this.initialize(e)};return i.extend=e.Model.extend,t.extend(i.prototype,e.Events,{setHandlers:function(e){t.each(e,function(e,i){var n=null;t.isObject(e)&&!t.isFunction(e)&&(n=e.context,e=e.callback),this.setHandler(i,e,n)},this)},setHandler:function(e,t,i){var n={callback:t,context:i};this._wreqrHandlers[e]=n,this.trigger("handler:add",e,t,i)},hasHandler:function(e){return!!this._wreqrHandlers[e]},getHandler:function(e){var t=this._wreqrHandlers[e];if(t)return function(){var e=Array.prototype.slice.apply(arguments);return t.callback.apply(t.context,e)}},removeHandler:function(e){delete this._wreqrHandlers[e]},removeAllHandlers:function(){this._wreqrHandlers={}}}),i}(e,t),n.CommandStorage=function(){var i=function(e){this.options=e,this._commands={},t.isFunction(this.initialize)&&this.initialize(e)};return t.extend(i.prototype,e.Events,{getCommands:function(e){var t=this._commands[e];return t||(t={command:e,instances:[]},this._commands[e]=t),t},addCommand:function(e,t){var i=this.getCommands(e);i.instances.push(t)},clearCommands:function(e){var t=this.getCommands(e);t.instances=[]}}),i}(),n.Commands=function(e){return e.Handlers.extend({storageType:e.CommandStorage,constructor:function(t){this.options=t||{},this._initializeStorage(this.options),this.on("handler:add",this._executeCommands,this);var i=Array.prototype.slice.call(arguments);e.Handlers.prototype.constructor.apply(this,i)},execute:function(e,t){e=arguments[0],t=Array.prototype.slice.call(arguments,1),this.hasHandler(e)?this.getHandler(e).apply(this,t):this.storage.addCommand(e,t)},_executeCommands:function(e,i,n){var s=this.storage.getCommands(e);t.each(s.instances,function(e){i.apply(n,e)}),this.storage.clearCommands(e)},_initializeStorage:function(e){var i,n=e.storageType||this.storageType;i=t.isFunction(n)?new n:n,this.storage=i}})}(n),n.RequestResponse=function(e){return e.Handlers.extend({request:function(){var e=arguments[0],t=Array.prototype.slice.call(arguments,1);return this.hasHandler(e)?this.getHandler(e).apply(this,t):void 0}})}(n),n.EventAggregator=function(e,t){var i=function(){};return i.extend=e.Model.extend,t.extend(i.prototype,e.Events),i}(e,t),n.Channel=function(){var i=function(t){this.vent=new e.Wreqr.EventAggregator,this.reqres=new e.Wreqr.RequestResponse,this.commands=new e.Wreqr.Commands,this.channelName=t};return t.extend(i.prototype,{reset:function(){return this.vent.off(),this.vent.stopListening(),this.reqres.removeAllHandlers(),this.commands.removeAllHandlers(),this},connectEvents:function(e,t){return this._connect("vent",e,t),this},connectCommands:function(e,t){return this._connect("commands",e,t),this},connectRequests:function(e,t){return this._connect("reqres",e,t),this},_connect:function(e,i,n){if(i){n=n||this;var s="vent"===e?"on":"setHandler";t.each(i,function(i,r){this[e][s](r,t.bind(i,n))},this)}}}),i}(n),n.radio=function(e){var i=function(){this._channels={},this.vent={},this.commands={},this.reqres={},this._proxyMethods()};t.extend(i.prototype,{channel:function(e){if(!e)throw new Error("Channel must receive a name");return this._getChannel(e)},_getChannel:function(t){var i=this._channels[t];return i||(i=new e.Channel(t),this._channels[t]=i),i},_proxyMethods:function(){t.each(["vent","commands","reqres"],function(e){t.each(n[e],function(t){this[e][t]=s(this,e,t)},this)},this)}});var n={vent:["on","off","trigger","once","stopListening","listenTo","listenToOnce"],commands:["execute","setHandler","setHandlers","removeHandler","removeAllHandlers"],reqres:["request","setHandler","setHandlers","removeHandler","removeAllHandlers"]},s=function(e,t,i){return function(n){var s=e._getChannel(n)[t],r=Array.prototype.slice.call(arguments,1);return s[i].apply(s,r)}};return new i}(n),e.Wreqr}(t,i);var s={};t.Marionette=s,s.$=t.$;var r=Array.prototype.slice;return s.extend=t.Model.extend,s.getOption=function(e,t){if(e&&t){var i;return i=e.options&&t in e.options&&void 0!==e.options[t]?e.options[t]:e[t]}},s.normalizeMethods=function(e){var t,n={};return i.each(e,function(e,s){t=e,i.isFunction(t)||(t=this[t]),t&&(n[s]=t)},this),n},s.normalizeUIKeys=function(e,t){return"undefined"!=typeof e?(i.each(i.keys(e),function(i){var n=/@ui.[a-zA-Z_$0-9]*/g;i.match(n)&&(e[i.replace(n,function(e){return t[e.slice(4)]})]=e[i],delete e[i])}),e):void 0},s.actAsCollection=function(e,t){var n=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];i.each(n,function(n){e[n]=function(){var e=i.values(i.result(this,t)),s=[e].concat(i.toArray(arguments));return i[n].apply(i,s)}})},s.triggerMethod=function(){function e(e,t,i){return i.toUpperCase()}var t=/(^|:)(\w)/gi,n=function(n){var s="on"+n.replace(t,e),r=this[s];return i.isFunction(this.trigger)&&this.trigger.apply(this,arguments),i.isFunction(r)?r.apply(this,i.tail(arguments)):void 0};return n}(),s.MonitorDOMRefresh=function(e){function t(e){e._isShown=!0,s(e)}function n(e){e._isRendered=!0,s(e)}function s(e){e._isShown&&e._isRendered&&r(e)&&i.isFunction(e.triggerMethod)&&e.triggerMethod("dom:refresh")}function r(t){return e.contains(t.el)}return function(e){e.listenTo(e,"show",function(){t(e)}),e.listenTo(e,"render",function(){n(e)})}}(document.documentElement),function(e){function t(e,t,s,r){var o=r.split(/\s+/);i.each(o,function(i){var r=e[i];r||n("Method '"+i+"' was configured as an event handler, but does not exist."),e.listenTo(t,s,r)})}function s(e,t,i,n){e.listenTo(t,i,n)}function r(e,t,n,s){var r=s.split(/\s+/);i.each(r,function(i){var s=e[i];e.stopListening(t,n,s)})}function o(e,t,i,n){e.stopListening(t,i,n)}function a(e,t,n,s,r){t&&n&&(i.isFunction(n)&&(n=n.call(e)),i.each(n,function(n,o){i.isFunction(n)?s(e,t,o,n):r(e,t,o,n)}))}e.bindEntityEvents=function(e,i,n){a(e,i,n,s,t)},e.unbindEntityEvents=function(e,t,i){a(e,t,i,o,r)}}(s),s.Callbacks=function(){this._deferred=s.$.Deferred(),this._callbacks=[]},i.extend(s.Callbacks.prototype,{add:function(e,t){this._callbacks.push({cb:e,ctx:t}),this._deferred.done(function(i,n){t&&(i=t),e.call(i,n)})},run:function(e,t){this._deferred.resolve(t,e)},reset:function(){var e=this._callbacks;this._deferred=s.$.Deferred(),this._callbacks=[],i.each(e,function(e){this.add(e.cb,e.ctx)},this)}}),s.Controller=function(e){this.triggerMethod=s.triggerMethod,this.options=e||{},i.isFunction(this.initialize)&&this.initialize(this.options)},s.Controller.extend=s.extend,i.extend(s.Controller.prototype,t.Events,{close:function(){this.stopListening();var e=Array.prototype.slice.call(arguments);this.triggerMethod.apply(this,["close"].concat(e)),this.off()}}),s.Region=function(e){if(this.options=e||{},this.el=s.getOption(this,"el"),this.el||n("An 'el' must be specified for a region.","NoElError"),this.initialize){var t=Array.prototype.slice.apply(arguments);this.initialize.apply(this,t)}},i.extend(s.Region,{buildRegion:function(e,t){var s=i.isString(e),r=i.isString(e.selector),o=i.isUndefined(e.regionType),a=i.isFunction(e);a||s||r||n("Region must be specified as a Region type, a selector string or an object with selector property");var h,l;s&&(h=e),e.selector&&(h=e.selector,delete e.selector),a&&(l=e),!a&&o&&(l=t),e.regionType&&(l=e.regionType,delete e.regionType),(s||a)&&(e={}),e.el=h;var c=new l(e);return e.parentEl&&(c.getEl=function(t){var n=e.parentEl;return i.isFunction(n)&&(n=n()),n.find(t)}),c}}),i.extend(s.Region.prototype,t.Events,{show:function(e,t){this.ensureEl();var n=t||{},r=e.isClosed||i.isUndefined(e.$el),o=e!==this.currentView,a=!!n.preventClose,h=!a&&o;return h&&this.close(),e.render(),s.triggerMethod.call(this,"before:show",e),i.isFunction(e.triggerMethod)?e.triggerMethod("before:show"):s.triggerMethod.call(e,"before:show"),(o||r)&&this.open(e),this.currentView=e,s.triggerMethod.call(this,"show",e),i.isFunction(e.triggerMethod)?e.triggerMethod("show"):s.triggerMethod.call(e,"show"),this},ensureEl:function(){this.$el&&0!==this.$el.length||(this.$el=this.getEl(this.el))},getEl:function(e){return s.$(e)},open:function(e){this.$el.empty().append(e.el)},close:function(){var e=this.currentView;e&&!e.isClosed&&(e.close?e.close():e.remove&&e.remove(),s.triggerMethod.call(this,"close",e),delete this.currentView)},attachView:function(e){this.currentView=e},reset:function(){this.close(),delete this.$el}}),s.Region.extend=s.extend,s.RegionManager=function(e){var t=e.Controller.extend({constructor:function(t){this._regions={},e.Controller.prototype.constructor.call(this,t)},addRegions:function(e,t){var n={};return i.each(e,function(e,s){i.isString(e)&&(e={selector:e}),e.selector&&(e=i.defaults({},e,t));var r=this.addRegion(s,e);n[s]=r},this),n},addRegion:function(t,n){var s,r=i.isObject(n),o=i.isString(n),a=!!n.selector;return s=o||r&&a?e.Region.buildRegion(n,e.Region):i.isFunction(n)?e.Region.buildRegion(n,e.Region):n,this._store(t,s),this.triggerMethod("region:add",t,s),s},get:function(e){return this._regions[e]},removeRegion:function(e){var t=this._regions[e];this._remove(e,t)},removeRegions:function(){i.each(this._regions,function(e,t){this._remove(t,e)},this)},closeRegions:function(){i.each(this._regions,function(e){e.close()},this)},close:function(){this.removeRegions(),e.Controller.prototype.close.apply(this,arguments)},_store:function(e,t){this._regions[e]=t,this._setLength()},_remove:function(e,t){t.close(),t.stopListening(),delete this._regions[e],this._setLength(),this.triggerMethod("region:remove",e,t)},_setLength:function(){this.length=i.size(this._regions)}});return e.actAsCollection(t.prototype,"_regions"),t}(s),s.TemplateCache=function(e){this.templateId=e},i.extend(s.TemplateCache,{templateCaches:{},get:function(e){var t=this.templateCaches[e];return t||(t=new s.TemplateCache(e),this.templateCaches[e]=t),t.load()},clear:function(){var e,t=r.call(arguments),i=t.length;if(i>0)for(e=0;i>e;e++)delete this.templateCaches[t[e]];else this.templateCaches={}}}),i.extend(s.TemplateCache.prototype,{load:function(){if(this.compiledTemplate)return this.compiledTemplate;var e=this.loadTemplate(this.templateId);return this.compiledTemplate=this.compileTemplate(e),this.compiledTemplate},loadTemplate:function(e){var t=s.$(e).html();return t&&0!==t.length||n("Could not find template: '"+e+"'","NoTemplateError"),t},compileTemplate:function(e){return i.template(e)}}),s.Renderer={render:function(e,t){e||n("Cannot render the template since it's false, null or undefined.","TemplateNotFoundError");var i;return(i="function"==typeof e?e:s.TemplateCache.get(e))(t)}},s.View=t.View.extend({constructor:function(e){i.bindAll(this,"render"),this.options=i.extend({},i.result(this,"options"),i.isFunction(e)?e.call(this):e),this.events=this.normalizeUIKeys(i.result(this,"events")),i.isObject(this.behaviors)&&new s.Behaviors(this),t.View.prototype.constructor.apply(this,arguments),s.MonitorDOMRefresh(this),this.listenTo(this,"show",this.onShowCalled)},triggerMethod:s.triggerMethod,normalizeMethods:s.normalizeMethods,getTemplate:function(){return s.getOption(this,"template")},mixinTemplateHelpers:function(e){e=e||{};var t=s.getOption(this,"templateHelpers");return i.isFunction(t)&&(t=t.call(this)),i.extend(e,t)},normalizeUIKeys:function(e){var t=i.result(this,"ui");return s.normalizeUIKeys(e,t)},configureTriggers:function(){if(this.triggers){var e={},t=this.normalizeUIKeys(i.result(this,"triggers"));return i.each(t,function(t,n){var s=i.isObject(t),r=s?t.event:t;e[n]=function(e){if(e){var i=e.preventDefault,n=e.stopPropagation,o=s?t.preventDefault:i,a=s?t.stopPropagation:n;o&&i&&i.apply(e),a&&n&&n.apply(e)}var h={view:this,model:this.model,collection:this.collection};this.triggerMethod(r,h)}},this),e}},delegateEvents:function(e){this._delegateDOMEvents(e),s.bindEntityEvents(this,this.model,s.getOption(this,"modelEvents")),s.bindEntityEvents(this,this.collection,s.getOption(this,"collectionEvents"))},_delegateDOMEvents:function(e){e=e||this.events,i.isFunction(e)&&(e=e.call(this));var n={},s=i.result(this,"behaviorEvents")||{},r=this.configureTriggers();i.extend(n,s,e,r),t.View.prototype.delegateEvents.call(this,n)},undelegateEvents:function(){var e=Array.prototype.slice.call(arguments);t.View.prototype.undelegateEvents.apply(this,e),s.unbindEntityEvents(this,this.model,s.getOption(this,"modelEvents")),s.unbindEntityEvents(this,this.collection,s.getOption(this,"collectionEvents"))},onShowCalled:function(){},close:function(){if(!this.isClosed){var e=Array.prototype.slice.call(arguments),t=this.triggerMethod.apply(this,["before:close"].concat(e));t!==!1&&(this.isClosed=!0,this.triggerMethod.apply(this,["close"].concat(e)),this.unbindUIElements(),this.remove())}},bindUIElements:function(){if(this.ui){this._uiBindings||(this._uiBindings=this.ui);var e=i.result(this,"_uiBindings");this.ui={},i.each(i.keys(e),function(t){var i=e[t];this.ui[t]=this.$(i)},this)}},unbindUIElements:function(){this.ui&&this._uiBindings&&(i.each(this.ui,function(e,t){delete this.ui[t]},this),this.ui=this._uiBindings,delete this._uiBindings)}}),s.ItemView=s.View.extend({constructor:function(){s.View.prototype.constructor.apply(this,arguments)},serializeData:function(){var e={};return this.model?e=this.model.toJSON():this.collection&&(e={items:this.collection.toJSON()}),e},render:function(){this.isClosed=!1,this.triggerMethod("before:render",this),this.triggerMethod("item:before:render",this);var e=this.serializeData();e=this.mixinTemplateHelpers(e);var t=this.getTemplate(),i=s.Renderer.render(t,e);return this.$el.html(i),this.bindUIElements(),this.triggerMethod("render",this),this.triggerMethod("item:rendered",this),this},close:function(){this.isClosed||(this.triggerMethod("item:before:close"),s.View.prototype.close.apply(this,arguments),this.triggerMethod("item:closed"))}}),s.CollectionView=s.View.extend({itemViewEventPrefix:"itemview",constructor:function(){this._initChildViewStorage(),s.View.prototype.constructor.apply(this,arguments),this._initialEvents(),this.initRenderBuffer()},initRenderBuffer:function(){this.elBuffer=document.createDocumentFragment(),this._bufferedChildren=[]},startBuffering:function(){this.initRenderBuffer(),this.isBuffering=!0},endBuffering:function(){this.isBuffering=!1,this.appendBuffer(this,this.elBuffer),this._triggerShowBufferedChildren(),this.initRenderBuffer()},_triggerShowBufferedChildren:function(){this._isShown&&(i.each(this._bufferedChildren,function(e){s.triggerMethod.call(e,"show")}),this._bufferedChildren=[])},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this.addChildView),this.listenTo(this.collection,"remove",this.removeItemView),this.listenTo(this.collection,"reset",this.render))},addChildView:function(e){this.closeEmptyView();var t=this.getItemView(e),i=this.collection.indexOf(e);this.addItemView(e,t,i)},onShowCalled:function(){this.children.each(function(e){s.triggerMethod.call(e,"show")})},triggerBeforeRender:function(){this.triggerMethod("before:render",this),this.triggerMethod("collection:before:render",this)},triggerRendered:function(){this.triggerMethod("render",this),this.triggerMethod("collection:rendered",this)},render:function(){return this.isClosed=!1,this.triggerBeforeRender(),this._renderChildren(),this.triggerRendered(),this},_renderChildren:function(){this.startBuffering(),this.closeEmptyView(),this.closeChildren(),this.isEmpty(this.collection)?this.showEmptyView():this.showCollection(),this.endBuffering()},showCollection:function(){var e;this.collection.each(function(t,i){e=this.getItemView(t),this.addItemView(t,e,i)},this)},showEmptyView:function(){var e=this.getEmptyView();if(e&&!this._showingEmptyView){this._showingEmptyView=!0;var i=new t.Model;this.addItemView(i,e,0)}},closeEmptyView:function(){this._showingEmptyView&&(this.closeChildren(),delete this._showingEmptyView)},getEmptyView:function(){return s.getOption(this,"emptyView")},getItemView:function(){var e=s.getOption(this,"itemView");return e||n("An `itemView` must be specified","NoItemViewError"),e},addItemView:function(e,t,n){var r=s.getOption(this,"itemViewOptions");i.isFunction(r)&&(r=r.call(this,e,n));var o=this.buildItemView(e,t,r);return this.addChildViewEventForwarding(o),this.triggerMethod("before:item:added",o),this.children.add(o),this.renderItemView(o,n),this._isShown&&!this.isBuffering&&s.triggerMethod.call(o,"show"),this.triggerMethod("after:item:added",o),o},addChildViewEventForwarding:function(e){var t=s.getOption(this,"itemViewEventPrefix");this.listenTo(e,"all",function(){var n=r.call(arguments),o=n[0],a=this.normalizeMethods(this.getItemEvents());n[0]=t+":"+o,n.splice(1,0,e),"undefined"!=typeof a&&i.isFunction(a[o])&&a[o].apply(this,n),s.triggerMethod.apply(this,n)},this)},getItemEvents:function(){return i.isFunction(this.itemEvents)?this.itemEvents.call(this):this.itemEvents},renderItemView:function(e,t){e.render(),this.appendHtml(this,e,t)},buildItemView:function(e,t,n){var s=i.extend({model:e},n);return new t(s)},removeItemView:function(e){var t=this.children.findByModel(e);this.removeChildView(t),this.checkEmpty()},removeChildView:function(e){e&&(e.close?e.close():e.remove&&e.remove(),this.stopListening(e),this.children.remove(e)),this.triggerMethod("item:removed",e)},isEmpty:function(){return!this.collection||0===this.collection.length},checkEmpty:function(){this.isEmpty(this.collection)&&this.showEmptyView()},appendBuffer:function(e,t){e.$el.append(t)},appendHtml:function(e,t){e.isBuffering?(e.elBuffer.appendChild(t.el),e._bufferedChildren.push(t)):e.$el.append(t.el)},_initChildViewStorage:function(){this.children=new t.ChildViewContainer},close:function(){this.isClosed||(this.triggerMethod("collection:before:close"),this.closeChildren(),this.triggerMethod("collection:closed"),s.View.prototype.close.apply(this,arguments))},closeChildren:function(){this.children.each(function(e){this.removeChildView(e)},this),this.checkEmpty()}}),s.CompositeView=s.CollectionView.extend({constructor:function(){s.CollectionView.prototype.constructor.apply(this,arguments)},_initialEvents:function(){this.once("render",function(){this.collection&&(this.listenTo(this.collection,"add",this.addChildView),this.listenTo(this.collection,"remove",this.removeItemView),this.listenTo(this.collection,"reset",this._renderChildren))})},getItemView:function(){var e=s.getOption(this,"itemView")||this.constructor;return e||n("An `itemView` must be specified","NoItemViewError"),e},serializeData:function(){var e={};return this.model&&(e=this.model.toJSON()),e},render:function(){this.isRendered=!0,this.isClosed=!1,this.resetItemViewContainer(),this.triggerBeforeRender();var e=this.renderModel();return this.$el.html(e),this.bindUIElements(),this.triggerMethod("composite:model:rendered"),this._renderChildren(),this.triggerMethod("composite:rendered"),this.triggerRendered(),this},_renderChildren:function(){this.isRendered&&(this.triggerMethod("composite:collection:before:render"),s.CollectionView.prototype._renderChildren.call(this),this.triggerMethod("composite:collection:rendered"))},renderModel:function(){var e={};e=this.serializeData(),e=this.mixinTemplateHelpers(e);var t=this.getTemplate();return s.Renderer.render(t,e)},appendBuffer:function(e,t){var i=this.getItemViewContainer(e);i.append(t)},appendHtml:function(e,t){if(e.isBuffering)e.elBuffer.appendChild(t.el),e._bufferedChildren.push(t);else{var i=this.getItemViewContainer(e);i.append(t.el)}},getItemViewContainer:function(e){if("$itemViewContainer"in e)return e.$itemViewContainer;var t,r=s.getOption(e,"itemViewContainer");if(r){var o=i.isFunction(r)?r.call(e):r;t="@"===o.charAt(0)&&e.ui?e.ui[o.substr(4)]:e.$(o),t.length<=0&&n("The specified `itemViewContainer` was not found: "+e.itemViewContainer,"ItemViewContainerMissingError")}else t=e.$el;return e.$itemViewContainer=t,t},resetItemViewContainer:function(){this.$itemViewContainer&&delete this.$itemViewContainer}}),s.Layout=s.ItemView.extend({regionType:s.Region,constructor:function(e){e=e||{},this._firstRender=!0,this._initializeRegions(e),s.ItemView.prototype.constructor.call(this,e)},render:function(){return this.isClosed&&this._initializeRegions(),this._firstRender?this._firstRender=!1:this.isClosed||this._reInitializeRegions(),s.ItemView.prototype.render.apply(this,arguments)},close:function(){this.isClosed||(this.regionManager.close(),s.ItemView.prototype.close.apply(this,arguments))},addRegion:function(e,t){var i={};return i[e]=t,this._buildRegions(i)[e]},addRegions:function(e){return this.regions=i.extend({},this.regions,e),this._buildRegions(e)},removeRegion:function(e){return delete this.regions[e],this.regionManager.removeRegion(e)},getRegion:function(e){return this.regionManager.get(e)},_buildRegions:function(e){var t=this,i={regionType:s.getOption(this,"regionType"),parentEl:function(){return t.$el}};return this.regionManager.addRegions(e,i)},_initializeRegions:function(e){var t;this._initRegionManager(),t=i.isFunction(this.regions)?this.regions(e):this.regions||{},this.addRegions(t)},_reInitializeRegions:function(){this.regionManager.closeRegions(),this.regionManager.each(function(e){e.reset()})},_initRegionManager:function(){this.regionManager=new s.RegionManager,this.listenTo(this.regionManager,"region:add",function(e,t){this[e]=t,this.trigger("region:add",e,t)}),this.listenTo(this.regionManager,"region:remove",function(e,t){delete this[e],this.trigger("region:remove",e,t)})}}),s.Behavior=function(e,t){function i(t,i){this.view=i,this.defaults=e.result(this,"defaults")||{},this.options=e.extend({},this.defaults,t),this.$=function(){return this.view.$.apply(this.view,arguments)},this.initialize.apply(this,arguments)}return e.extend(i.prototype,t.Events,{initialize:function(){},close:function(){this.stopListening()},triggerMethod:s.triggerMethod}),i.extend=s.extend,i}(i,t),s.Behaviors=function(e,t){function i(e){this.behaviors=i.parseBehaviors(e,t.result(e,"behaviors")),i.wrap(e,this.behaviors,["bindUIElements","unbindUIElements","delegateEvents","undelegateEvents","behaviorEvents","triggerMethod","setElement","close"])}var n={setElement:function(e,i){e.apply(this,t.tail(arguments,2)),t.each(i,function(e){e.$el=this.$el},this)},close:function(e,i){var n=t.tail(arguments,2);e.apply(this,n),t.invoke(i,"close",n)},bindUIElements:function(e,i){e.apply(this),t.invoke(i,e)},unbindUIElements:function(e,i){e.apply(this),t.invoke(i,e)},triggerMethod:function(e,i){var n=t.tail(arguments,2);e.apply(this,n),t.each(i,function(t){e.apply(t,n)})},delegateEvents:function(i,n){var s=t.tail(arguments,2);i.apply(this,s),t.each(n,function(t){e.bindEntityEvents(t,this.model,e.getOption(t,"modelEvents")),e.bindEntityEvents(t,this.collection,e.getOption(t,"collectionEvents"))},this)},undelegateEvents:function(i,n){var s=t.tail(arguments,2);i.apply(this,s),t.each(n,function(t){e.unbindEntityEvents(t,this.model,e.getOption(t,"modelEvents")),e.unbindEntityEvents(t,this.collection,e.getOption(t,"collectionEvents"))},this)},behaviorEvents:function(i,n){var s={},r=t.result(this,"ui");return t.each(n,function(i,n){var o={},a=t.result(i,"events")||{},h=t.result(i,"ui"),l=t.extend({},r,h);a=e.normalizeUIKeys(a,l),t.each(t.keys(a),function(e){var s=new Array(n+2).join(" "),r=e+s,h=t.isFunction(a[e])?a[e]:i[a[e]];o[r]=t.bind(h,i)}),s=t.extend(s,o)}),s}};return t.extend(i,{behaviorsLookup:function(){throw new Error("You must define where your behaviors are stored. See https://github.com/marionettejs/backbone.marionette/blob/master/docs/marionette.behaviors.md#behaviorslookup")},getBehaviorClass:function(e,n){return e.behaviorClass?e.behaviorClass:t.isFunction(i.behaviorsLookup)?i.behaviorsLookup.apply(this,arguments)[n]:i.behaviorsLookup[n]},parseBehaviors:function(e,n){return t.map(n,function(t,n){var s=i.getBehaviorClass(t,n);return new s(t,e)})},wrap:function(e,i,s){t.each(s,function(s){e[s]=t.partial(n[s],e[s],i)})}}),i}(s,i),s.AppRouter=t.Router.extend({constructor:function(e){t.Router.prototype.constructor.apply(this,arguments),this.options=e||{};var i=s.getOption(this,"appRoutes"),n=this._getController();this.processAppRoutes(n,i),this.on("route",this._processOnRoute,this)},appRoute:function(e,t){var i=this._getController();this._addAppRoute(i,e,t)},_processOnRoute:function(e,t){var n=i.invert(this.appRoutes)[e];i.isFunction(this.onRoute)&&this.onRoute(e,n,t)},processAppRoutes:function(e,t){if(t){var n=i.keys(t).reverse();i.each(n,function(i){this._addAppRoute(e,i,t[i])},this)}},_getController:function(){return s.getOption(this,"controller")},_addAppRoute:function(e,t,s){var r=e[s];r||n("Method '"+s+"' was not found on the controller"),this.route(t,s,i.bind(r,e))}}),s.Application=function(e){this._initRegionManager(),this._initCallbacks=new s.Callbacks,this.vent=new t.Wreqr.EventAggregator,this.commands=new t.Wreqr.Commands,this.reqres=new t.Wreqr.RequestResponse,this.submodules={},i.extend(this,e),this.triggerMethod=s.triggerMethod},i.extend(s.Application.prototype,t.Events,{execute:function(){this.commands.execute.apply(this.commands,arguments)},request:function(){return this.reqres.request.apply(this.reqres,arguments)},addInitializer:function(e){this._initCallbacks.add(e)},start:function(e){this.triggerMethod("initialize:before",e),this._initCallbacks.run(e,this),this.triggerMethod("initialize:after",e),this.triggerMethod("start",e)},addRegions:function(e){return this._regionManager.addRegions(e)},closeRegions:function(){this._regionManager.closeRegions()},removeRegion:function(e){this._regionManager.removeRegion(e)},getRegion:function(e){return this._regionManager.get(e)},module:function(e,t){var i=s.Module.getClass(t),n=r.call(arguments);return n.unshift(this),i.create.apply(i,n)},_initRegionManager:function(){this._regionManager=new s.RegionManager,this.listenTo(this._regionManager,"region:add",function(e,t){this[e]=t}),this.listenTo(this._regionManager,"region:remove",function(e){delete this[e]})}}),s.Application.extend=s.extend,s.Module=function(e,t,n){this.moduleName=e,this.options=i.extend({},this.options,n),this.initialize=n.initialize||this.initialize,this.submodules={},this._setupInitializersAndFinalizers(),this.app=t,this.startWithParent=!0,this.triggerMethod=s.triggerMethod,i.isFunction(this.initialize)&&this.initialize(this.options,e,t)},s.Module.extend=s.extend,i.extend(s.Module.prototype,t.Events,{initialize:function(){},addInitializer:function(e){this._initializerCallbacks.add(e)},addFinalizer:function(e){this._finalizerCallbacks.add(e)},start:function(e){this._isInitialized||(i.each(this.submodules,function(t){t.startWithParent&&t.start(e)}),this.triggerMethod("before:start",e),this._initializerCallbacks.run(e,this),this._isInitialized=!0,this.triggerMethod("start",e))},stop:function(){this._isInitialized&&(this._isInitialized=!1,s.triggerMethod.call(this,"before:stop"),i.each(this.submodules,function(e){e.stop()}),this._finalizerCallbacks.run(void 0,this),this._initializerCallbacks.reset(),this._finalizerCallbacks.reset(),s.triggerMethod.call(this,"stop"))},addDefinition:function(e,t){this._runModuleDefinition(e,t)},_runModuleDefinition:function(e,n){if(e){var r=i.flatten([this,this.app,t,s,s.$,i,n]);e.apply(this,r)}},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new s.Callbacks,this._finalizerCallbacks=new s.Callbacks}}),i.extend(s.Module,{create:function(e,t,n){var s=e,o=r.call(arguments);o.splice(0,3),t=t.split(".");var a=t.length,h=[];return h[a-1]=n,i.each(t,function(t,i){var r=s;s=this._getModule(r,t,e,n),this._addModuleDefinition(r,s,h[i],o)},this),s},_getModule:function(e,t,n,s){var r=i.extend({},s),o=this.getClass(s),a=e[t];return a||(a=new o(t,n,r),e[t]=a,e.submodules[t]=a),a},getClass:function(e){var t=s.Module;return e?e.prototype instanceof t?e:e.moduleClass||t:t},_addModuleDefinition:function(e,t,i,n){var s=this._getDefine(i),r=this._getStartWithParent(i,t);s&&t.addDefinition(s,n),this._addStartWithParent(e,t,r)},_getStartWithParent:function(e,t){var n;return i.isFunction(e)&&e.prototype instanceof s.Module?(n=t.constructor.prototype.startWithParent,i.isUndefined(n)?!0:n):i.isObject(e)?(n=e.startWithParent,i.isUndefined(n)?!0:n):!0},_getDefine:function(e){return!i.isFunction(e)||e.prototype instanceof s.Module?i.isObject(e)?e.define:null:e},_addStartWithParent:function(e,t,i){t.startWithParent=t.startWithParent&&i,t.startWithParent&&!t.startWithParentIsConfigured&&(t.startWithParentIsConfigured=!0,e.addInitializer(function(e){t.startWithParent&&t.start(e)}))}}),s}(this,Backbone,_);