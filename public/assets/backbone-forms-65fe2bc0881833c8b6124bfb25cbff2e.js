!function(e){if("undefined"!=typeof exports&&"undefined"!=typeof require)var t=e._||require("underscore"),i=e.Backbone||require("backbone");else var t=e._,i=e.Backbone;var s=i.View.extend({events:{submit:function(e){this.trigger("submit",e)}},initialize:function(e){var i=this;e=this.options=t.extend({submitButton:!1},e);var s=this.schema=function(){if(e.schema)return t.result(e,"schema");var s=e.model;return s&&s.schema?t.result(s,"schema"):i.schema?t.result(i,"schema"):{}}();t.extend(this,t.pick(e,"model","data","idPrefix","templateData"));var r=this.constructor;this.template=e.template||this.template||r.template,this.Fieldset=e.Fieldset||this.Fieldset||r.Fieldset,this.Field=e.Field||this.Field||r.Field,this.NestedField=e.NestedField||this.NestedField||r.NestedField;var n=this.selectedFields=e.fields||t.keys(s),a=this.fields={};t.each(n,function(e){var t=s[e];a[e]=this.createField(e,t)},this);{var o=e.fieldsets||t.result(this,"fieldsets")||[n];this.fieldsets=[]}t.each(o,function(e){this.fieldsets.push(this.createFieldset(e))},this)},createFieldset:function(e){var t={schema:e,fields:this.fields};return new this.Fieldset(t)},createField:function(e,t){var i={form:this,key:e,schema:t,idPrefix:this.idPrefix};this.model?i.model=this.model:i.value=this.data?this.data[e]:null;var s=new this.Field(i);return this.listenTo(s.editor,"all",this.handleEditorEvent),s},handleEditorEvent:function(e,i){var s=i.key+":"+e;switch(this.trigger.call(this,s,this,i,Array.prototype.slice.call(arguments,2)),e){case"change":this.trigger("change",this);break;case"focus":this.hasFocus||this.trigger("focus",this);break;case"blur":if(this.hasFocus){var r=this;setTimeout(function(){var e=t.find(r.fields,function(e){return e.editor.hasFocus});e||r.trigger("blur",r)},0)}}},templateData:function(){var e=this.options;return{submitButton:e.submitButton}},render:function(){var e=this,s=this.fields,r=i.$,n=r(r.trim(this.template(t.result(this,"templateData"))));return n.find("[data-editors]").add(n).each(function(i,n){var a=r(n),o=a.attr("data-editors");if(!t.isUndefined(o)){var l="*"==o?e.selectedFields||t.keys(s):o.split(",");t.each(l,function(e){var t=s[e];a.append(t.editor.render().el)})}}),n.find("[data-fields]").add(n).each(function(i,n){var a=r(n),o=a.attr("data-fields");if(!t.isUndefined(o)){var l="*"==o?e.selectedFields||t.keys(s):o.split(",");t.each(l,function(e){var t=s[e];a.append(t.render().el)})}}),n.find("[data-fieldsets]").add(n).each(function(i,s){var n=r(s),a=n.attr("data-fieldsets");t.isUndefined(a)||t.each(e.fieldsets,function(e){n.append(e.render().el)})}),this.setElement(n),n.addClass(this.className),this},validate:function(e){var i=this.fields,s=this.model,r={};if(e=e||{},t.each(i,function(e){var t=e.validate();t&&(r[e.key]=t)}),!e.skipModelValidate&&s&&s.validate){var n=s.validate(this.getValue());if(n){var a=t.isObject(n)&&!t.isArray(n);a||(r._others=r._others||[],r._others.push(n)),a&&t.each(n,function(e,t){if(i[t]&&!r[t])i[t].setError(e),r[t]=e;else{r._others=r._others||[];var s={};s[t]=e,r._others.push(s)}})}}return t.isEmpty(r)?null:r},commit:function(e){e=e||{};var i={skipModelValidate:!e.validate},s=this.validate(i);if(s)return s;var r,n=t.extend({error:function(e,t){r=t}},e);return this.model.set(this.getValue(),n),r?r:void 0},getValue:function(e){if(e)return this.fields[e].getValue();var i={};return t.each(this.fields,function(e){i[e.key]=e.getValue()}),i},setValue:function(e,t){var i={};"string"==typeof e?i[e]=t:i=e;var s;for(s in this.schema)void 0!==i[s]&&this.fields[s].setValue(i[s])},getEditor:function(e){var t=this.fields[e];if(!t)throw new Error("Field not found: "+e);return t.editor},focus:function(){if(!this.hasFocus){var e=this.fieldsets[0],t=e.getFieldAt(0);t&&t.editor.focus()}},blur:function(){if(this.hasFocus){var e=t.find(this.fields,function(e){return e.editor.hasFocus});e&&e.editor.blur()}},trigger:function(e){return"focus"===e?this.hasFocus=!0:"blur"===e&&(this.hasFocus=!1),i.View.prototype.trigger.apply(this,arguments)},remove:function(){return t.each(this.fieldsets,function(e){e.remove()}),t.each(this.fields,function(e){e.remove()}),i.View.prototype.remove.apply(this,arguments)}},{template:t.template('    <form>     <div data-fieldsets></div>      <% if (submitButton) { %>        <button type="submit"><%= submitButton %></button>      <% } %>    </form>  ',null,this.templateSettings),templateSettings:{evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},editors:{}});s.validators=function(){var e={};return e.errMessages={required:"Required",regexp:"Invalid",number:"Must be a number",email:"Invalid email address",url:"Invalid URL",match:t.template('Must match field "<%= field %>"',null,s.templateSettings)},e.required=function(e){return e=t.extend({type:"required",message:this.errMessages.required},e),function(i){e.value=i;var s={type:e.type,message:t.isFunction(e.message)?e.message(e):e.message};return null===i||void 0===i||i===!1||""===i?s:void 0}},e.regexp=function(e){if(!e.regexp)throw new Error('Missing required "regexp" option for "regexp" validator');return e=t.extend({type:"regexp",match:!0,message:this.errMessages.regexp},e),function(i){e.value=i;var s={type:e.type,message:t.isFunction(e.message)?e.message(e):e.message};if(null!==i&&void 0!==i&&""!==i)return"string"==typeof e.regexp&&(e.regexp=new RegExp(e.regexp,e.flags)),(e.match?!e.regexp.test(i):e.regexp.test(i))?s:void 0}},e.number=function(i){return i=t.extend({type:"number",message:this.errMessages.number,regexp:/^[0-9]*\.?[0-9]*?$/},i),e.regexp(i)},e.email=function(i){return i=t.extend({type:"email",message:this.errMessages.email,regexp:/^[\w\-]{1,}([\w\-\+.]{1,1}[\w\-]{1,}){0,}[@][\w\-]{1,}([.]([\w\-]{1,})){1,3}$/},i),e.regexp(i)},e.url=function(i){return i=t.extend({type:"url",message:this.errMessages.url,regexp:/^(http|https):\/\/(([A-Z0-9][A-Z0-9_\-]*)(\.[A-Z0-9][A-Z0-9_\-]*)+)(:(\d+))?\/?/i},i),e.regexp(i)},e.match=function(e){if(!e.field)throw new Error('Missing required "field" options for "match" validator');return e=t.extend({type:"match",message:this.errMessages.match},e),function(i,s){e.value=i;var r={type:e.type,message:t.isFunction(e.message)?e.message(e):e.message};if(null!==i&&void 0!==i&&""!==i)return i!==s[e.field]?r:void 0}},e}(),s.Fieldset=i.View.extend({initialize:function(e){e=e||{};var i=this.schema=this.createSchema(e.schema);this.fields=t.pick(e.fields,i.fields),this.template=e.template||i.template||this.template||this.constructor.template},createSchema:function(e){return t.isArray(e)&&(e={fields:e}),e.legend=e.legend||null,e},getFieldAt:function(e){var t=this.schema.fields[e];return this.fields[t]},templateData:function(){return this.schema},render:function(){var e=(this.schema,this.fields),s=i.$,r=s(s.trim(this.template(t.result(this,"templateData"))));return r.find("[data-fields]").add(r).each(function(i,r){var n=s(r),a=n.attr("data-fields");t.isUndefined(a)||t.each(e,function(e){n.append(e.render().el)})}),this.setElement(r),this},remove:function(){t.each(this.fields,function(e){e.remove()}),i.View.prototype.remove.call(this)}},{template:t.template("    <fieldset data-fields>      <% if (legend) { %>        <legend><%= legend %></legend>      <% } %>    </fieldset>  ",null,s.templateSettings)}),s.Field=i.View.extend({initialize:function(e){e=e||{},t.extend(this,t.pick(e,"form","key","model","value","idPrefix"));var i=this.schema=this.createSchema(e.schema);this.template=e.template||i.template||this.template||this.constructor.template,this.errorClassName=e.errorClassName||this.errorClassName||this.constructor.errorClassName,this.editor=this.createEditor()},createSchema:function(e){return t.isString(e)&&(e={type:e}),e=t.extend({type:"Text",title:this.createTitle()},e),e.type=t.isString(e.type)?s.editors[e.type]:e.type,e},createEditor:function(){var e=t.extend(t.pick(this,"schema","form","key","model","value"),{id:this.createEditorId()}),i=this.schema.type;return new i(e)},createEditorId:function(){var e=this.idPrefix,i=this.key;return i=i.replace(/\./g,"_"),t.isString(e)||t.isNumber(e)?e+i:t.isNull(e)?i:this.model?this.model.cid+"_"+i:i},createTitle:function(){var e=this.key;return e=e.replace(/([A-Z])/g," $1"),e=e.replace(/^./,function(e){return e.toUpperCase()})},templateData:function(){var e=this.schema;return{help:e.help||"",title:e.title,fieldAttrs:e.fieldAttrs,editorAttrs:e.editorAttrs,key:this.key,editorId:this.editor.id}},render:function(){var e=this.schema,r=this.editor,n=i.$;if(e.type==s.editors.Hidden)return this.setElement(r.render().el);var a=n(n.trim(this.template(t.result(this,"templateData"))));return e.fieldClass&&a.addClass(e.fieldClass),e.fieldAttrs&&a.attr(e.fieldAttrs),a.find("[data-editor]").add(a).each(function(e,i){var s=n(i),a=s.attr("data-editor");t.isUndefined(a)||s.append(r.render().el)}),this.setElement(a),this},validate:function(){var e=this.editor.validate();return e?this.setError(e.message):this.clearError(),e},setError:function(e){this.editor.hasNestedForm||(this.$el.addClass(this.errorClassName),this.$("[data-error]").html(e))},clearError:function(){this.$el.removeClass(this.errorClassName),this.$("[data-error]").empty()},commit:function(){return this.editor.commit()},getValue:function(){return this.editor.getValue()},setValue:function(e){this.editor.setValue(e)},focus:function(){this.editor.focus()},blur:function(){this.editor.blur()},remove:function(){this.editor.remove(),i.View.prototype.remove.call(this)}},{template:t.template('    <div>      <label for="<%= editorId %>"><%= title %></label>      <div>        <span data-editor></span>        <div data-error></div>        <div><%= help %></div>      </div>    </div>  ',null,s.templateSettings),errorClassName:"error"}),s.NestedField=s.Field.extend({template:t.template("    <div>      <span data-editor></span>      <% if (help) { %>        <div><%= help %></div>      <% } %>      <div data-error></div>    </div>  ",null,s.templateSettings)}),s.Editor=s.editors.Base=i.View.extend({defaultValue:null,hasFocus:!1,initialize:function(e){var e=e||{};if(e.model){if(!e.key)throw new Error("Missing option: 'key'");this.model=e.model,this.value=this.model.get(e.key)}else void 0!==e.value&&(this.value=e.value);void 0===this.value&&(this.value=this.defaultValue),t.extend(this,t.pick(e,"key","form"));var i=this.schema=e.schema||{};this.validators=e.validators||i.validators,this.$el.attr("id",this.id),this.$el.attr("name",this.getName()),i.editorClass&&this.$el.addClass(i.editorClass),i.editorAttrs&&this.$el.attr(i.editorAttrs)},getName:function(){var e=this.key||"";return e.replace(/\./g,"_")},getValue:function(){return this.value},setValue:function(e){this.value=e},focus:function(){throw new Error("Not implemented")},blur:function(){throw new Error("Not implemented")},commit:function(e){var t=this.validate();return t?t:(this.listenTo(this.model,"invalid",function(e,i){t=i}),this.model.set(this.key,this.getValue(),e),t?t:void 0)},validate:function(){var e=(this.$el,null),i=this.getValue(),s=this.form?this.form.getValue():{},r=this.validators,n=this.getValidator;return r&&t.every(r,function(t){return e=n(t)(i,s),e?!1:!0}),e},trigger:function(e){return"focus"===e?this.hasFocus=!0:"blur"===e&&(this.hasFocus=!1),i.View.prototype.trigger.apply(this,arguments)},getValidator:function(e){var i=s.validators;if(t.isRegExp(e))return i.regexp({regexp:e});if(t.isString(e)){if(!i[e])throw new Error('Validator "'+e+'" not found');return i[e]()}if(t.isFunction(e))return e;if(t.isObject(e)&&e.type){var r=e;return i[r.type](r)}throw new Error("Invalid validator: "+e)}}),s.editors.Text=s.Editor.extend({tagName:"input",defaultValue:"",previousValue:"",events:{keyup:"determineChange",keypress:function(){var e=this;setTimeout(function(){e.determineChange()},0)},select:function(){this.trigger("select",this)},focus:function(){this.trigger("focus",this)},blur:function(){this.trigger("blur",this)}},initialize:function(e){s.editors.Base.prototype.initialize.call(this,e);var t=this.schema,i="text";t&&t.editorAttrs&&t.editorAttrs.type&&(i=t.editorAttrs.type),t&&t.dataType&&(i=t.dataType),this.$el.attr("type",i)},render:function(){return this.setValue(this.value),this},determineChange:function(){var e=this.$el.val(),t=e!==this.previousValue;t&&(this.previousValue=e,this.trigger("change",this))},getValue:function(){return this.$el.val()},setValue:function(e){this.$el.val(e)},focus:function(){this.hasFocus||this.$el.focus()},blur:function(){this.hasFocus&&this.$el.blur()},select:function(){this.$el.select()}}),s.editors.TextArea=s.editors.Text.extend({tagName:"textarea",initialize:function(e){s.editors.Base.prototype.initialize.call(this,e)}}),s.editors.Password=s.editors.Text.extend({initialize:function(e){s.editors.Text.prototype.initialize.call(this,e),this.$el.attr("type","password")}}),s.editors.Number=s.editors.Text.extend({defaultValue:0,events:t.extend({},s.editors.Text.prototype.events,{keypress:"onKeyPress",change:"onKeyPress"}),initialize:function(e){s.editors.Text.prototype.initialize.call(this,e);var t=this.schema;this.$el.attr("type","number"),t&&t.editorAttrs&&t.editorAttrs.step||this.$el.attr("step","any")},onKeyPress:function(e){var t=this,i=function(){setTimeout(function(){t.determineChange()},0)};if(0===e.charCode)return void i();var s=this.$el.val();void 0!=e.charCode&&(s+=String.fromCharCode(e.charCode));var r=/^[0-9]*\.?[0-9]*?$/.test(s);r?i():e.preventDefault()},getValue:function(){var e=this.$el.val();return""===e?null:parseFloat(e,10)},setValue:function(e){e=function(){return t.isNumber(e)?e:t.isString(e)&&""!==e?parseFloat(e,10):null}(),t.isNaN(e)&&(e=null),s.editors.Text.prototype.setValue.call(this,e)}}),s.editors.Hidden=s.editors.Text.extend({defaultValue:"",initialize:function(e){s.editors.Text.prototype.initialize.call(this,e),this.$el.attr("type","hidden")},focus:function(){},blur:function(){}}),s.editors.Checkbox=s.editors.Base.extend({defaultValue:!1,tagName:"input",events:{click:function(){this.trigger("change",this)},focus:function(){this.trigger("focus",this)},blur:function(){this.trigger("blur",this)}},initialize:function(e){s.editors.Base.prototype.initialize.call(this,e),this.$el.attr("type","checkbox")},render:function(){return this.setValue(this.value),this},getValue:function(){return this.$el.prop("checked")},setValue:function(e){e?this.$el.prop("checked",!0):this.$el.prop("checked",!1)},focus:function(){this.hasFocus||this.$el.focus()},blur:function(){this.hasFocus&&this.$el.blur()}}),s.editors.Select=s.editors.Base.extend({tagName:"select",previousValue:"",events:{keyup:"determineChange",keypress:function(){var e=this;setTimeout(function(){e.determineChange()},0)},change:function(){this.trigger("change",this)},focus:function(){this.trigger("focus",this)},blur:function(){this.trigger("blur",this)}},initialize:function(e){if(s.editors.Base.prototype.initialize.call(this,e),!this.schema||!this.schema.options)throw new Error("Missing required 'schema.options'")},render:function(){return this.setOptions(this.schema.options),this},setOptions:function(e){var s=this;if(e instanceof i.Collection){var r=e;r.length>0?this.renderOptions(e):r.fetch({success:function(){s.renderOptions(e)}})}else t.isFunction(e)?e(function(e){s.renderOptions(e)},s):this.renderOptions(e)},renderOptions:function(e){var t,i=this.$el;t=this._getOptionsHtml(e),i.html(t),this.setValue(this.value)},_getOptionsHtml:function(e){var s;if(t.isString(e))s=e;else if(t.isArray(e))s=this._arrayToHtml(e);else if(e instanceof i.Collection)s=this._collectionToHtml(e);else if(t.isFunction(e)){var r;e(function(e){r=e},this),s=this._getOptionsHtml(r)}else s=this._objectToHtml(e);return s},determineChange:function(){var e=this.getValue(),t=e!==this.previousValue;t&&(this.previousValue=e,this.trigger("change",this))},getValue:function(){return this.$el.val()},setValue:function(e){this.$el.val(e)},focus:function(){this.hasFocus||this.$el.focus()},blur:function(){this.hasFocus&&this.$el.blur()},_collectionToHtml:function(e){var t=[];e.each(function(e){t.push({val:e.id,label:e.toString()})});var i=this._arrayToHtml(t);return i},_objectToHtml:function(e){var t=[];for(var i in e)e.hasOwnProperty(i)&&t.push({val:i,label:e[i]});var s=this._arrayToHtml(t);return s},_arrayToHtml:function(e){var i=[];return t.each(e,function(e){if(t.isObject(e))if(e.group)i.push('<optgroup label="'+e.group+'">'),i.push(this._getOptionsHtml(e.options)),i.push("</optgroup>");else{var s=e.val||0===e.val?e.val:"";i.push('<option value="'+s+'">'+e.label+"</option>")}else i.push("<option>"+e+"</option>")},this),i.join("")}}),s.editors.Radio=s.editors.Select.extend({tagName:"ul",events:{"change input[type=radio]":function(){this.trigger("change",this)},"focus input[type=radio]":function(){this.hasFocus||this.trigger("focus",this)},"blur input[type=radio]":function(){if(this.hasFocus){var e=this;setTimeout(function(){e.$("input[type=radio]:focus")[0]||e.trigger("blur",e)},0)}}},getTemplate:function(){return this.schema.template||this.constructor.template},getValue:function(){return this.$("input[type=radio]:checked").val()},setValue:function(e){this.$("input[type=radio]").val([e])},focus:function(){if(!this.hasFocus){var e=this.$("input[type=radio]:checked");return e[0]?void e.focus():void this.$("input[type=radio]").first().focus()}},blur:function(){this.hasFocus&&this.$("input[type=radio]:focus").blur()},_arrayToHtml:function(e){var i=this,s=this.getTemplate(),r=i.getName(),n=i.id,a=t.map(e,function(e,i){var s={name:r,id:n+"-"+i};return t.isObject(e)?(s.value=e.val||0===e.val?e.val:"",s.label=e.label):(s.value=e,s.label=e),s});return s({items:a})}},{template:t.template('    <% _.each(items, function(item) { %>      <li>        <input type="radio" name="<%= item.name %>" value="<%= item.value %>" id="<%= item.id %>" />        <label for="<%= item.id %>"><%= item.label %></label>      </li>    <% }); %>  ',null,s.templateSettings)}),s.editors.Checkboxes=s.editors.Select.extend({tagName:"ul",groupNumber:0,events:{"click input[type=checkbox]":function(){this.trigger("change",this)},"focus input[type=checkbox]":function(){this.hasFocus||this.trigger("focus",this)},"blur input[type=checkbox]":function(){if(this.hasFocus){var e=this;setTimeout(function(){e.$("input[type=checkbox]:focus")[0]||e.trigger("blur",e)},0)}}},getValue:function(){var e=[];return this.$("input[type=checkbox]:checked").each(function(){e.push($(this).val())}),e},setValue:function(e){t.isArray(e)||(e=[e]),this.$("input[type=checkbox]").val(e)},focus:function(){this.hasFocus||this.$("input[type=checkbox]").first().focus()},blur:function(){this.hasFocus&&this.$("input[type=checkbox]:focus").blur()},_arrayToHtml:function(e){var i=[],s=this;return t.each(e,function(e,r){var n="<li>",a=!0;if(t.isObject(e))if(e.group){var o=s.id;s.id+="-"+s.groupNumber++,n='<fieldset class="group"> <legend>'+e.group+"</legend>",n+=s._arrayToHtml(e.options),n+="</fieldset>",s.id=o,a=!1}else{var l=e.val||0===e.val?e.val:"";n+='<input type="checkbox" name="'+s.getName()+'" value="'+l+'" id="'+s.id+"-"+r+'" />',n+='<label for="'+s.id+"-"+r+'">'+e.label+"</label>"}else n+='<input type="checkbox" name="'+s.getName()+'" value="'+e+'" id="'+s.id+"-"+r+'" />',n+='<label for="'+s.id+"-"+r+'">'+e+"</label>";a&&(n+="</li>"),i.push(n)}),i.join("")}}),s.editors.Object=s.editors.Base.extend({hasNestedForm:!0,initialize:function(e){if(this.value={},s.editors.Base.prototype.initialize.call(this,e),!this.form)throw new Error('Missing required option "form"');if(!this.schema.subSchema)throw new Error("Missing required 'schema.subSchema' option for Object editor")},render:function(){var e=this.form.constructor;return this.nestedForm=new e({schema:this.schema.subSchema,data:this.value,idPrefix:this.id+"_",Field:e.NestedField}),this._observeFormEvents(),this.$el.html(this.nestedForm.render().el),this.hasFocus&&this.trigger("blur",this),this},getValue:function(){return this.nestedForm?this.nestedForm.getValue():this.value},setValue:function(e){this.value=e,this.render()},focus:function(){this.hasFocus||this.nestedForm.focus()},blur:function(){this.hasFocus&&this.nestedForm.blur()},remove:function(){this.nestedForm.remove(),i.View.prototype.remove.call(this)},validate:function(){return this.nestedForm.validate()},_observeFormEvents:function(){this.nestedForm&&this.nestedForm.on("all",function(){var e=t.toArray(arguments);e[1]=this,this.trigger.apply(this,e)},this)}}),s.editors.NestedModel=s.editors.Object.extend({initialize:function(e){if(s.editors.Base.prototype.initialize.call(this,e),!this.form)throw new Error('Missing required option "form"');if(!e.schema.model)throw new Error('Missing required "schema.model" option for NestedModel editor')},render:function(){var e=this.form.constructor,t=this.value||{},i=(this.key,this.schema.model),s=t.constructor===i?t:new i(t);return this.nestedForm=new e({model:s,idPrefix:this.id+"_",fieldTemplate:"nestedField"}),this._observeFormEvents(),this.$el.html(this.nestedForm.render().el),this.hasFocus&&this.trigger("blur",this),this},commit:function(){var e=this.nestedForm.commit();return e?(this.$el.addClass("error"),e):s.editors.Object.prototype.commit.call(this)}}),s.editors.Date=s.editors.Base.extend({events:{"change select":function(){this.updateHidden(),this.trigger("change",this)},"focus select":function(){this.hasFocus||this.trigger("focus",this)},"blur select":function(){if(this.hasFocus){var e=this;setTimeout(function(){e.$("select:focus")[0]||e.trigger("blur",e)},0)}}},initialize:function(e){e=e||{},s.editors.Base.prototype.initialize.call(this,e);var i=s.editors.Date,r=new Date;if(this.options=t.extend({monthNames:i.monthNames,showMonthNames:i.showMonthNames},e),this.schema=t.extend({yearStart:r.getFullYear()-100,yearEnd:r.getFullYear()},e.schema||{}),this.value&&!t.isDate(this.value)&&(this.value=new Date(this.value)),!this.value){var n=new Date;n.setSeconds(0),n.setMilliseconds(0),this.value=n}this.template=e.template||this.constructor.template},render:function(){var e=this.options,s=this.schema,r=i.$,n=t.map(t.range(1,32),function(e){return'<option value="'+e+'">'+e+"</option>"}),a=t.map(t.range(0,12),function(t){var i=e.showMonthNames?e.monthNames[t]:t+1;return'<option value="'+t+'">'+i+"</option>"}),o=s.yearStart<s.yearEnd?t.range(s.yearStart,s.yearEnd+1):t.range(s.yearStart,s.yearEnd-1,-1),l=t.map(o,function(e){return'<option value="'+e+'">'+e+"</option>"}),u=r(r.trim(this.template({dates:n.join(""),months:a.join(""),years:l.join("")})));return this.$date=u.find('[data-type="date"]'),this.$month=u.find('[data-type="month"]'),this.$year=u.find('[data-type="year"]'),this.$hidden=r('<input type="hidden" name="'+this.key+'" />'),u.append(this.$hidden),this.setValue(this.value),this.setElement(u),this.$el.attr("id",this.id),this.$el.attr("name",this.getName()),this.hasFocus&&this.trigger("blur",this),this},getValue:function(){var e=this.$year.val(),t=this.$month.val(),i=this.$date.val();return e&&t&&i?new Date(e,t,i):null},setValue:function(e){this.$date.val(e.getDate()),this.$month.val(e.getMonth()),this.$year.val(e.getFullYear()),this.updateHidden()},focus:function(){this.hasFocus||this.$("select").first().focus()},blur:function(){this.hasFocus&&this.$("select:focus").blur()},updateHidden:function(){var e=this.getValue();t.isDate(e)&&(e=e.toISOString()),this.$hidden.val(e)}},{template:t.template('    <div>      <select data-type="date"><%= dates %></select>      <select data-type="month"><%= months %></select>      <select data-type="year"><%= years %></select>    </div>  ',null,s.templateSettings),showMonthNames:!0,monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"]}),s.editors.DateTime=s.editors.Base.extend({events:{"change select":function(){this.updateHidden(),this.trigger("change",this)},"focus select":function(){this.hasFocus||this.trigger("focus",this)},"blur select":function(){if(this.hasFocus){var e=this;setTimeout(function(){e.$("select:focus")[0]||e.trigger("blur",e)},0)}}},initialize:function(e){e=e||{},s.editors.Base.prototype.initialize.call(this,e),this.options=t.extend({DateEditor:s.editors.DateTime.DateEditor},e),this.schema=t.extend({minsInterval:15},e.schema||{}),this.dateEditor=new this.options.DateEditor(e),this.value=this.dateEditor.value,this.template=e.template||this.constructor.template},render:function(){function e(e){return 10>e?"0"+e:e}var s=this.schema,r=i.$,n=t.map(t.range(0,24),function(t){return'<option value="'+t+'">'+e(t)+"</option>"}),a=t.map(t.range(0,60,s.minsInterval),function(t){return'<option value="'+t+'">'+e(t)+"</option>"}),o=r(r.trim(this.template({hours:n.join(),mins:a.join()})));return o.find("[data-date]").append(this.dateEditor.render().el),this.$hour=o.find('select[data-type="hour"]'),this.$min=o.find('select[data-type="min"]'),this.$hidden=o.find('input[type="hidden"]'),this.setValue(this.value),this.setElement(o),this.$el.attr("id",this.id),this.$el.attr("name",this.getName()),this.hasFocus&&this.trigger("blur",this),this},getValue:function(){var e=this.dateEditor.getValue(),t=this.$hour.val(),i=this.$min.val();return e&&t&&i?(e.setHours(t),e.setMinutes(i),e):null},setValue:function(e){t.isDate(e)||(e=new Date(e)),this.dateEditor.setValue(e),this.$hour.val(e.getHours()),this.$min.val(e.getMinutes()),this.updateHidden()},focus:function(){this.hasFocus||this.$("select").first().focus()},blur:function(){this.hasFocus&&this.$("select:focus").blur()},updateHidden:function(){var e=this.getValue();t.isDate(e)&&(e=e.toISOString()),this.$hidden.val(e)},remove:function(){this.dateEditor.remove(),s.editors.Base.prototype.remove.call(this)}},{template:t.template('    <div class="bbf-datetime">      <div class="bbf-date-container" data-date></div>      <select data-type="hour"><%= hours %></select>      :      <select data-type="min"><%= mins %></select>    </div>  ',null,s.templateSettings),DateEditor:s.editors.Date}),s.VERSION="0.14.0",i.Form=s,"undefined"!=typeof module&&(module.exports=s)}(window||global||this);